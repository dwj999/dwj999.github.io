<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="github," />





  <link rel="alternate" href="/atom.xml" title="Jiessie's' Blog" type="application/atom+xml" />






<meta name="description" content="引言gh-ost 是github开源的在线DDL工具，从发布之后就受到了同行的广泛关注，由于其采用的伪装从库的方式同步增量DML，比pt-online-schema-change采用的触发器更友好，且生产开销较小，是一款很优秀的在线DDL工具。 原理gh-ost 介绍gh-ost 作为一个伪装的备库，可以从主库/备库上拉取 binlog，过滤之后重新应用到主库上去，相当于主库上的增量操作通过 bi">
<meta name="keywords" content="github">
<meta property="og:type" content="article">
<meta property="og:title" content="gh-ost 使用教程">
<meta property="og:url" content="https://dwj999.github.io/gh-ost-使用教程.html">
<meta property="og:site_name" content="Jiessie&#39;s&#39; Blog">
<meta property="og:description" content="引言gh-ost 是github开源的在线DDL工具，从发布之后就受到了同行的广泛关注，由于其采用的伪装从库的方式同步增量DML，比pt-online-schema-change采用的触发器更友好，且生产开销较小，是一款很优秀的在线DDL工具。 原理gh-ost 介绍gh-ost 作为一个伪装的备库，可以从主库/备库上拉取 binlog，过滤之后重新应用到主库上去，相当于主库上的增量操作通过 bi">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://qanp7f2om.bkt.clouddn.com/gh-ost01.png">
<meta property="og:image" content="http://qanp7f2om.bkt.clouddn.com/gh-ost02.png">
<meta property="og:updated_time" content="2020-06-02T01:49:01.022Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gh-ost 使用教程">
<meta name="twitter:description" content="引言gh-ost 是github开源的在线DDL工具，从发布之后就受到了同行的广泛关注，由于其采用的伪装从库的方式同步增量DML，比pt-online-schema-change采用的触发器更友好，且生产开销较小，是一款很优秀的在线DDL工具。 原理gh-ost 介绍gh-ost 作为一个伪装的备库，可以从主库/备库上拉取 binlog，过滤之后重新应用到主库上去，相当于主库上的增量操作通过 bi">
<meta name="twitter:image" content="http://qanp7f2om.bkt.clouddn.com/gh-ost01.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://dwj999.github.io/gh-ost-使用教程.html"/>





<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>

  <title>gh-ost 使用教程 | Jiessie's' Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"><a href="https://github.com/dwj999" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></div>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jiessie's' Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">没伞的孩子必须努力奔跑</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dwj999.github.io/gh-ost-使用教程.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiessie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/jiessie.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiessie's' Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">gh-ost 使用教程</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-11T14:02:16+08:00">
                2018-10-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/工具/" itemprop="url" rel="index">
                    <span itemprop="name">工具</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      
        <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>gh-ost 是github开源的在线DDL工具，从发布之后就受到了同行的广泛关注，由于其采用的伪装从库的方式同步增量DML，比pt-online-schema-change采用的触发器更友好，且生产开销较小，是一款很优秀的在线DDL工具。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><h3 id="gh-ost-介绍"><a href="#gh-ost-介绍" class="headerlink" title="gh-ost 介绍"></a>gh-ost 介绍</h3><p>gh-ost 作为一个伪装的备库，可以从主库/备库上拉取 binlog，过滤之后重新应用到主库上去，相当于主库上的增量操作通过 binlog 又应用回主库本身，不过是应用在幽灵表上。<br><br><img src="http://qanp7f2om.bkt.clouddn.com/gh-ost01.png" alt="image"></p>
<p>大致工作过程：<br><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.gh-ost 首先连接到主库上，根据 <span class="keyword">alter</span> 语句创建幽灵表</span><br><span class="line"><span class="number">2.</span>然后作为一个备库连接到其中一个真正的备库或者主库上(根据具体的参数来定)，一边在主库上拷贝已有的数据到幽灵表，一边从备库上拉取增量数据的 <span class="keyword">binlog</span>，然后不断的把 <span class="keyword">binlog</span> 应用回主库</span><br><span class="line"><span class="number">3.</span>等待全部数据同步完成，进行 cut-<span class="keyword">over</span> 幽灵表和原表切换</span><br></pre></td></tr></table></figure></p>
<h3 id="general-log"><a href="#general-log" class="headerlink" title="general_log"></a>general_log</h3><p>通过打开mysql的general_log，查看gh-ost的具体执行过程：<br><br>mysql: 5.7.22<br><br>gh-ost：1.0.48<br><br>此案例使用了–allow-on-master 参数，DDL在主库上操作<br><br>执行语句：<br><br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">./gh-ost \</span><br><span class="line">-<span class="ruby">-max-load=Threads_running=<span class="number">25</span> \</span></span><br><span class="line"><span class="ruby">--critical-load=Threads_running=<span class="number">512</span> \</span></span><br><span class="line"><span class="ruby">--chunk-size=<span class="number">1000</span> \</span></span><br><span class="line"><span class="ruby">--initially-drop-old-table \</span></span><br><span class="line"><span class="ruby">--initially-drop-ghost-table \</span></span><br><span class="line"><span class="ruby">--initially-drop-socket-file \</span></span><br><span class="line"><span class="ruby">--ok-to-drop-table \</span></span><br><span class="line"><span class="ruby">--conf=<span class="string">"/etc/my.cnf"</span> \</span></span><br><span class="line"><span class="ruby">--host=<span class="string">"localhost"</span> \</span></span><br><span class="line"><span class="ruby">--port=<span class="number">3306</span> \</span></span><br><span class="line"><span class="ruby">--user=<span class="string">"root"</span> \</span></span><br><span class="line"><span class="ruby">--password=<span class="string">"xxx"</span> \</span></span><br><span class="line"><span class="ruby">--database=<span class="string">"test"</span> \</span></span><br><span class="line"><span class="ruby">--table=<span class="string">"employee1"</span> \</span></span><br><span class="line"><span class="ruby">--verbose \</span></span><br><span class="line"><span class="ruby">--alter=<span class="string">"engine=innodb"</span> \</span></span><br><span class="line"><span class="ruby">--switch-to-rbr \</span></span><br><span class="line"><span class="ruby">--allow-on-master \</span></span><br><span class="line"><span class="ruby">--allow-master-master \</span></span><br><span class="line"><span class="ruby">--cut-over=default \</span></span><br><span class="line"><span class="ruby">--default-retries=<span class="number">120</span> \</span></span><br><span class="line"><span class="ruby">--panic-flag-file=<span class="regexp">/tmp/ghost</span>.panic.flag \</span></span><br><span class="line"><span class="ruby">--execute</span></span><br></pre></td></tr></table></figure></p>
<p>执行过程：<br><br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">2018-10<span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">27</span> INFO starting gh-ost <span class="number">1.0</span><span class="number">.48</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">27</span> INFO Migrating <span class="symbol">`test`</span>.<span class="symbol">`employee1`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">27</span> INFO connection validated <span class="keyword">on</span> localhost:<span class="number">3306</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">27</span> INFO <span class="keyword">User</span> has <span class="keyword">ALL</span> privileges</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">27</span> INFO <span class="keyword">binary</span> logs validated <span class="keyword">on</span> localhost:<span class="number">3306</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">27</span> INFO Restarting replication <span class="keyword">on</span> localhost:<span class="number">3306</span> <span class="keyword">to</span> make sure binlog settings apply <span class="keyword">to</span> replication thread</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">27</span> INFO Inspector initiated <span class="keyword">on</span> VM_24_101_centos:<span class="number">3306</span>, version <span class="number">5.7</span><span class="number">.22</span>-<span class="built_in">log</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">27</span> INFO Table found. Engine=InnoDB</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Estimated <span class="keyword">number</span> of rows <span class="keyword">via</span> <span class="keyword">EXPLAIN</span>: <span class="number">10028</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Recursively searching <span class="keyword">for</span> replication master</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Master found <span class="keyword">to</span> be VM_24_101_centos:<span class="number">3306</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO log_slave_updates validated <span class="keyword">on</span> localhost:<span class="number">3306</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO connection validated <span class="keyword">on</span> localhost:<span class="number">3306</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Connecting binlog streamer at bin<span class="number">.000070</span>:<span class="number">320607755</span></span><br><span class="line">[<span class="number">2020</span>/<span class="number">05</span>/<span class="number">29</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span>] [info] binlogsyncer.go:<span class="number">133</span> <span class="keyword">create</span> BinlogSyncer <span class="keyword">with</span> config &#123;<span class="number">99999</span> mysql localhost <span class="number">3306</span> root    <span class="literal">false</span> <span class="literal">false</span> &lt;nil&gt; <span class="literal">false</span> UTC <span class="literal">true</span> <span class="number">0</span> <span class="number">0</span>s <span class="number">0</span>s <span class="number">0</span> <span class="literal">false</span>&#125;</span><br><span class="line">[<span class="number">2020</span>/<span class="number">05</span>/<span class="number">29</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span>] [info] binlogsyncer.go:<span class="number">354</span> <span class="keyword">begin</span> <span class="keyword">to</span> sync binlog <span class="keyword">from</span> <span class="built_in">position</span> (bin<span class="number">.000070</span>, <span class="number">320607755</span>)</span><br><span class="line">[<span class="number">2020</span>/<span class="number">05</span>/<span class="number">29</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span>] [info] binlogsyncer.go:<span class="number">203</span> register slave <span class="keyword">for</span> master server localhost:<span class="number">3306</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO rotate <span class="keyword">to</span> next <span class="built_in">log</span> <span class="keyword">from</span> bin<span class="number">.000070</span>:<span class="number">0</span> <span class="keyword">to</span> bin<span class="number">.000070</span></span><br><span class="line">[<span class="number">2020</span>/<span class="number">05</span>/<span class="number">29</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span>] [info] binlogsyncer.go:<span class="number">723</span> rotate <span class="keyword">to</span> (bin<span class="number">.000070</span>, <span class="number">320607755</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO connection validated <span class="keyword">on</span> localhost:<span class="number">3306</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO connection validated <span class="keyword">on</span> localhost:<span class="number">3306</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO will <span class="keyword">use</span> time_zone=<span class="string">'SYSTEM'</span> <span class="keyword">on</span> applier</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Examining table structure <span class="keyword">on</span> applier</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Applier initiated <span class="keyword">on</span> VM_24_101_centos:<span class="number">3306</span>, version <span class="number">5.7</span><span class="number">.22</span>-<span class="built_in">log</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Dropping table <span class="symbol">`test`</span>.<span class="symbol">`_employee1_gho`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Table dropped</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Dropping table <span class="symbol">`test`</span>.<span class="symbol">`_employee1_del`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Table dropped</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Dropping table <span class="symbol">`test`</span>.<span class="symbol">`_employee1_ghc`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Table dropped</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Creating changelog table <span class="symbol">`test`</span>.<span class="symbol">`_employee1_ghc`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Changelog table created</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Creating ghost table <span class="symbol">`test`</span>.<span class="symbol">`_employee1_gho`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Ghost table created</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Altering ghost table <span class="symbol">`test`</span>.<span class="symbol">`_employee1_gho`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Ghost table altered</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Intercepted changelog state GhostTableMigrated</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Waiting <span class="keyword">for</span> ghost table <span class="keyword">to</span> be migrated. Current lag <span class="keyword">is</span> <span class="number">0</span>s</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Handled changelog state GhostTableMigrated</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Chosen shared <span class="keyword">unique</span> <span class="keyword">key</span> <span class="keyword">is</span> <span class="keyword">PRIMARY</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Shared columns are id,employeeid,employeename</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Listening <span class="keyword">on</span> unix socket file: /tmp/gh-ost.test.employee1.sock</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Migration <span class="built_in">min</span> <span class="keyword">values</span>: [<span class="number">1</span>]</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Migration <span class="built_in">max</span> <span class="keyword">values</span>: [<span class="number">10000</span>]</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO Waiting <span class="keyword">for</span> <span class="keyword">first</span> throttle metrics <span class="keyword">to</span> be collected</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">28</span> INFO <span class="keyword">First</span> throttle metrics collected</span><br><span class="line"># Migrating <span class="symbol">`test`</span>.<span class="symbol">`employee1`</span>; Ghost table is `test`.`_employee1_gho`</span><br><span class="line"># Migrating VM_24_101_centos:3306; inspecting VM_24_101_centos:3306; executing on VM_24_101_centos</span><br><span class="line"># Migration started at Fri May 29 15:38:27 +0800 2020</span><br><span class="line"># chunk-size: 1000; max-lag-millis: 1500ms; dml-batch-size: 10; max-load: Threads_running=25; critical-load: Threads_running=512; nice-ratio: 0.000000</span><br><span class="line"># throttle-additional-flag-file: /tmp/gh-ost.throttle </span><br><span class="line"># panic-flag-file: /tmp/ghost.panic.flag</span><br><span class="line"># Serving on unix socket: /tmp/gh-ost.test.employee1.sock</span><br><span class="line">Copy: 0/10028 0.0%; Applied: 0; Backlog: 0/1000; Time: 0s(total), 0s(copy); streamer: bin.000070:320610958; State: migrating; ETA: N/A</span><br><span class="line">Copy: 0/10028 0.0%; Applied: 0; Backlog: 0/1000; Time: 1s(total), 1s(copy); streamer: bin.000070:320618234; State: migrating; ETA: N/A</span><br><span class="line">2018-10<span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Row copy complete</span><br><span class="line">Copy: <span class="number">10000</span>/<span class="number">10000</span> <span class="number">100.0</span>%; Applied: 0; Backlog: 0/1000; Time: 1s(total), 1s(copy); streamer: bin.000070:320813452; State: migrating; ETA: due</span><br><span class="line">2018-10<span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Grabbing voluntary lock: gh-ost<span class="number">.40312</span>.lock</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Setting LOCK timeout <span class="keyword">as</span> <span class="number">6</span> seconds</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Looking <span class="keyword">for</span> magic cut-<span class="keyword">over</span> table</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Creating magic cut-<span class="keyword">over</span> table <span class="symbol">`test`</span>.<span class="symbol">`_employee1_del`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Magic cut-<span class="keyword">over</span> table created</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Locking <span class="symbol">`test`</span>.<span class="symbol">`employee1`</span>, <span class="symbol">`test`</span>.<span class="symbol">`_employee1_del`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Tables locked</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Session locking original &amp; magic tables <span class="keyword">is</span> <span class="number">40312</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Writing changelog state: AllEventsUpToLockProcessed:<span class="number">1590737909807671836</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Intercepted changelog state AllEventsUpToLockProcessed</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Handled changelog state AllEventsUpToLockProcessed</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">29</span> INFO Waiting <span class="keyword">for</span> events up <span class="keyword">to</span> lock</span><br><span class="line">Copy: <span class="number">10000</span>/<span class="number">10000</span> <span class="number">100.0</span>%; Applied: 0; Backlog: 1/1000; Time: 2s(total), 1s(copy); streamer: bin.000070:320823747; State: migrating; ETA: due</span><br><span class="line">2018-10<span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">30</span> INFO Waiting <span class="keyword">for</span> events up <span class="keyword">to</span> lock: got AllEventsUpToLockProcessed:<span class="number">1590737909807671836</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">30</span> INFO Done waiting <span class="keyword">for</span> events up <span class="keyword">to</span> lock; duration=974.564957ms</span><br><span class="line"># Migrating `test`.`employee1`; Ghost table is `test`.`_employee1_gho`</span><br><span class="line"># Migrating VM_24_101_centos:3306; inspecting VM_24_101_centos:3306; executing on VM_24_101_centos</span><br><span class="line"># Migration started at Fri May 29 15:38:27 +0800 2020</span><br><span class="line"># chunk-size: 1000; max-lag-millis: 1500ms; dml-batch-size: 10; max-load: Threads_running=25; critical-load: Threads_running=512; nice-ratio: 0.000000</span><br><span class="line"># throttle-additional-flag-file: /tmp/gh-ost.throttle </span><br><span class="line"># panic-flag-file: /tmp/ghost.panic.flag</span><br><span class="line"># Serving on unix socket: /tmp/gh-ost.test.employee1.sock</span><br><span class="line">Copy: 10000/10000 100.0%; Applied: 0; Backlog: 0/1000; Time: 2s(total), 1s(copy); streamer: bin.000070:320825878; State: migrating; ETA: due</span><br><span class="line">2018-10<span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">30</span> INFO Setting <span class="keyword">RENAME</span> timeout <span class="keyword">as</span> <span class="number">3</span> seconds</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">30</span> INFO Session renaming tables <span class="keyword">is</span> <span class="number">40314</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">30</span> INFO Issuing <span class="keyword">and</span> expecting this <span class="keyword">to</span> block: <span class="keyword">rename</span> <span class="comment">/* gh-ost */</span> table <span class="symbol">`test`</span>.<span class="symbol">`employee1`</span> <span class="keyword">to</span> <span class="symbol">`test`</span>.<span class="symbol">`_employee1_del`</span>, <span class="symbol">`test`</span>.<span class="symbol">`_employee1_gho`</span> <span class="keyword">to</span> <span class="symbol">`test`</span>.<span class="symbol">`employee1`</span></span><br><span class="line">Copy: <span class="number">10000</span>/<span class="number">10000</span> <span class="number">100.0</span>%; Applied: 0; Backlog: 0/1000; Time: 3s(total), 1s(copy); streamer: bin.000070:320832073; State: migrating; ETA: due</span><br><span class="line">2018-10<span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Found atomic <span class="keyword">RENAME</span> <span class="keyword">to</span> be blocking, <span class="keyword">as</span> expected. Double checking the lock <span class="keyword">is</span> still <span class="keyword">in</span> place (though I don t strictly have <span class="keyword">to</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Checking session lock: gh-ost<span class="number">.40312</span>.lock</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Connection holding lock <span class="keyword">on</span> original table still <span class="keyword">exists</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Will now proceed <span class="keyword">to</span> <span class="keyword">drop</span> magic table <span class="keyword">and</span> unlock tables</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Dropping magic cut-<span class="keyword">over</span> table</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Releasing lock <span class="keyword">from</span> <span class="symbol">`test`</span>.<span class="symbol">`employee1`</span>, <span class="symbol">`test`</span>.<span class="symbol">`_employee1_del`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Tables unlocked</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Tables renamed</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Lock &amp; <span class="keyword">rename</span> duration: <span class="number">2.021372845</span>s. During this time, queries <span class="keyword">on</span> <span class="symbol">`employee1`</span> were blocked</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Looking <span class="keyword">for</span> magic cut-<span class="keyword">over</span> table</span><br><span class="line">[<span class="number">2020</span>/<span class="number">05</span>/<span class="number">29</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span>] [info] binlogsyncer.go:<span class="number">164</span> syncer <span class="keyword">is</span> closing...</span><br><span class="line">[<span class="number">2020</span>/<span class="number">05</span>/<span class="number">29</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span>] [error] binlogstreamer.go:<span class="number">77</span> close sync <span class="keyword">with</span> err: sync <span class="keyword">is</span> been closing...</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Closed streamer connection. err=&lt;nil&gt;</span><br><span class="line">[<span class="number">2020</span>/<span class="number">05</span>/<span class="number">29</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span>] [info] binlogsyncer.go:<span class="number">179</span> syncer <span class="keyword">is</span> closed</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Dropping table <span class="symbol">`test`</span>.<span class="symbol">`_employee1_ghc`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Table dropped</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Dropping table <span class="symbol">`test`</span>.<span class="symbol">`_employee1_del`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Table dropped</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Done migrating <span class="symbol">`test`</span>.<span class="symbol">`employee1`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Removing socket file: /tmp/gh-ost.test.employee1.sock</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Tearing down inspector</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Tearing down applier</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Tearing down streamer</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span> <span class="number">15</span>:<span class="number">38</span>:<span class="number">31</span> INFO Tearing down throttler</span><br><span class="line"># Done</span><br><span class="line">[mysql@VM_24_101_centos ~]$</span><br></pre></td></tr></table></figure></p>
<p>打印的general_log：<br><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br></pre></td><td class="code"><pre><span class="line">2018-10-11T15:38:27.796759+08:00	40303 Connect	root@127.0.0.1 on test using TCP/IP</span><br><span class="line">2018-10-11T15:38:27.796967+08:00	40303 Query	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.797151</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.797283</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.797446</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.version</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.797751</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.port</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.797976</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.hostname, @@global.port</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.798176</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="comment">/* gh-ost */</span> <span class="keyword">grants</span> <span class="keyword">for</span> <span class="keyword">current_user</span>()</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.798307</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.log_bin, @@global.binlog_format</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.798396</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.binlog_row_image</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.799003</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40304</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> information_schema <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.799177</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40304</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.799343</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40304</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.799460</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40304</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.799571</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40304</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">slave</span> <span class="keyword">status</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.799829</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40304</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.799880</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">status</span> <span class="keyword">from</span> <span class="string">`test`</span> <span class="keyword">like</span> <span class="string">'employee1'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">27.800450</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span></span><br><span class="line">			<span class="keyword">SUM</span>(REFERENCED_TABLE_NAME <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">AND</span> TABLE_SCHEMA=<span class="string">'test'</span> <span class="keyword">AND</span> TABLE_NAME=<span class="string">'employee1'</span>) <span class="keyword">as</span> num_child_side_fk,</span><br><span class="line">			<span class="keyword">SUM</span>(REFERENCED_TABLE_NAME <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">AND</span> REFERENCED_TABLE_SCHEMA=<span class="string">'test'</span> <span class="keyword">AND</span> REFERENCED_TABLE_NAME=<span class="string">'employee1'</span>) <span class="keyword">as</span> num_parent_side_fk</span><br><span class="line">		<span class="keyword">FROM</span> INFORMATION_SCHEMA.KEY_COLUMN_USAGE</span><br><span class="line">		<span class="keyword">WHERE</span></span><br><span class="line">				REFERENCED_TABLE_NAME <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">				<span class="keyword">AND</span> ((TABLE_SCHEMA=<span class="string">'test'</span> <span class="keyword">AND</span> TABLE_NAME=<span class="string">'employee1'</span>)</span><br><span class="line">					<span class="keyword">OR</span> (REFERENCED_TABLE_SCHEMA=<span class="string">'test'</span> <span class="keyword">AND</span> REFERENCED_TABLE_NAME=<span class="string">'employee1'</span>)</span><br><span class="line">				)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.328510</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> num_triggers</span><br><span class="line">			<span class="keyword">FROM</span> INFORMATION_SCHEMA.TRIGGERS</span><br><span class="line">			<span class="keyword">WHERE</span></span><br><span class="line">				TRIGGER_SCHEMA=<span class="string">'test'</span></span><br><span class="line">				<span class="keyword">AND</span> EVENT_OBJECT_TABLE=<span class="string">'employee1'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.334174</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">explain</span> <span class="keyword">select</span> <span class="comment">/* gh-ost */</span> * <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">where</span> <span class="number">1</span>=<span class="number">1</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.359593</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span></span><br><span class="line">      COLUMNS.TABLE_SCHEMA,</span><br><span class="line">      COLUMNS.TABLE_NAME,</span><br><span class="line">      COLUMNS.COLUMN_NAME,</span><br><span class="line">      UNIQUES.INDEX_NAME,</span><br><span class="line">      UNIQUES.COLUMN_NAMES,</span><br><span class="line">      UNIQUES.COUNT_COLUMN_IN_INDEX,</span><br><span class="line">      COLUMNS.DATA_TYPE,</span><br><span class="line">      COLUMNS.CHARACTER_SET_NAME,</span><br><span class="line">			<span class="keyword">LOCATE</span>(<span class="string">'auto_increment'</span>, EXTRA) &gt; <span class="number">0</span> <span class="keyword">as</span> is_auto_increment,</span><br><span class="line">      has_nullable</span><br><span class="line">    <span class="keyword">FROM</span> INFORMATION_SCHEMA.COLUMNS <span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line">      <span class="keyword">SELECT</span></span><br><span class="line">        TABLE_SCHEMA,</span><br><span class="line">        TABLE_NAME,</span><br><span class="line">        INDEX_NAME,</span><br><span class="line">        <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> COUNT_COLUMN_IN_INDEX,</span><br><span class="line">        <span class="keyword">GROUP_CONCAT</span>(COLUMN_NAME <span class="keyword">ORDER</span> <span class="keyword">BY</span> SEQ_IN_INDEX <span class="keyword">ASC</span>) <span class="keyword">AS</span> COLUMN_NAMES,</span><br><span class="line">        SUBSTRING_INDEX(<span class="keyword">GROUP_CONCAT</span>(COLUMN_NAME <span class="keyword">ORDER</span> <span class="keyword">BY</span> SEQ_IN_INDEX <span class="keyword">ASC</span>), <span class="string">','</span>, <span class="number">1</span>) <span class="keyword">AS</span> FIRST_COLUMN_NAME,</span><br><span class="line">        <span class="keyword">SUM</span>(NULLABLE=<span class="string">'YES'</span>) &gt; <span class="number">0</span> <span class="keyword">AS</span> has_nullable</span><br><span class="line">      <span class="keyword">FROM</span> INFORMATION_SCHEMA.STATISTICS</span><br><span class="line">      <span class="keyword">WHERE</span></span><br><span class="line">				NON_UNIQUE=<span class="number">0</span></span><br><span class="line">				<span class="keyword">AND</span> TABLE_SCHEMA = <span class="string">'test'</span></span><br><span class="line">      	<span class="keyword">AND</span> TABLE_NAME = <span class="string">'employee1'</span></span><br><span class="line">      <span class="keyword">GROUP</span> <span class="keyword">BY</span> TABLE_SCHEMA, TABLE_NAME, INDEX_NAME</span><br><span class="line">    ) <span class="keyword">AS</span> UNIQUES</span><br><span class="line">    <span class="keyword">ON</span> (</span><br><span class="line">      COLUMNS.COLUMN_NAME = UNIQUES.FIRST_COLUMN_NAME</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">      COLUMNS.TABLE_SCHEMA = <span class="string">'test'</span></span><br><span class="line">      <span class="keyword">AND</span> COLUMNS.TABLE_NAME = <span class="string">'employee1'</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">      COLUMNS.TABLE_SCHEMA, COLUMNS.TABLE_NAME,</span><br><span class="line">      <span class="keyword">CASE</span> UNIQUES.INDEX_NAME</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">'PRIMARY'</span> <span class="keyword">THEN</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">1</span></span><br><span class="line">      <span class="keyword">END</span>,</span><br><span class="line">      <span class="keyword">CASE</span> has_nullable</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">1</span></span><br><span class="line">      <span class="keyword">END</span>,</span><br><span class="line">      <span class="keyword">CASE</span> <span class="keyword">IFNULL</span>(CHARACTER_SET_NAME, <span class="string">''</span>)</span><br><span class="line">          <span class="keyword">WHEN</span> <span class="string">''</span> <span class="keyword">THEN</span> <span class="number">0</span></span><br><span class="line">          <span class="keyword">ELSE</span> <span class="number">1</span></span><br><span class="line">      <span class="keyword">END</span>,</span><br><span class="line">      <span class="keyword">CASE</span> DATA_TYPE</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">'tinyint'</span> <span class="keyword">THEN</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">'smallint'</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">'int'</span> <span class="keyword">THEN</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">'bigint'</span> <span class="keyword">THEN</span> <span class="number">3</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">100</span></span><br><span class="line">      <span class="keyword">END</span>,</span><br><span class="line">      COUNT_COLUMN_IN_INDEX</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.361667</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.362720</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40305</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> information_schema <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.362951</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40305</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.363171</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40305</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.363300</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40305</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.363417</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40305</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">slave</span> <span class="keyword">status</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.363647</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40305</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.363739</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.log_slave_updates</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.364010</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.version</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.364218</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.port</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.364408</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="comment">/* gh-ost readCurrentBinlogCoordinates */</span> <span class="keyword">master</span> <span class="keyword">status</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.365328</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40306</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span>  <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.365632</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40306</span> <span class="keyword">Query</span>	<span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'BINLOG_CHECKSUM'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.366882</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40306</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> @master_binlog_checksum=<span class="string">'NONE'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.367450</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40306</span> <span class="keyword">Binlog</span> Dump	<span class="keyword">Log</span>: <span class="string">'bin.000070'</span>  Pos: <span class="number">320607755</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.367748</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.version</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.368343</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.port</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.368961</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40307</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.369102</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40307</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.369202</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40307</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.369283</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40307</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.369362</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40307</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.version</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.369513</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40307</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.port</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.369636</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.time_zone</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.369918</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> @@global.hostname, @@global.port</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.370060</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.370612</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">drop</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.377122</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">status</span> <span class="keyword">from</span> <span class="string">`test`</span> <span class="keyword">like</span> <span class="string">'_employee1_gho'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.377393</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">drop</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`test`</span>.<span class="string">`_employee1_del`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.378699</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">status</span> <span class="keyword">from</span> <span class="string">`test`</span> <span class="keyword">like</span> <span class="string">'_employee1_del'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.378938</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">drop</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.385496</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">create</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> (</span><br><span class="line">			<span class="keyword">id</span> <span class="built_in">bigint</span> auto_increment,</span><br><span class="line">			last_update <span class="keyword">timestamp</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">			hint <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">charset</span> <span class="keyword">ascii</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">			<span class="keyword">value</span> <span class="built_in">varchar</span>(<span class="number">4096</span>) <span class="keyword">charset</span> <span class="keyword">ascii</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">			primary <span class="keyword">key</span>(<span class="keyword">id</span>),</span><br><span class="line">			<span class="keyword">unique</span> <span class="keyword">key</span> hint_uidx(hint)</span><br><span class="line">		) auto_increment=<span class="number">256</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.419446</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">create</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> <span class="keyword">like</span> <span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.445917</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">alter</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> <span class="keyword">engine</span>=<span class="keyword">innodb</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.480994</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">2</span>, <span class="number">0</span>), <span class="string">'state'</span>, <span class="string">'GhostTableMigrated'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.483727</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="string">'state at 1590737908483609931'</span>, <span class="string">'GhostTableMigrated'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.487362</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:28.487157014+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.487438</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40308</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> information_schema <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.487582</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40308</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.487684</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40308</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.487744</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40308</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.487897</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40308</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">slave</span> <span class="keyword">status</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.488401</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.488525</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.488614</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.488679</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.488893</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span></span><br><span class="line">      COLUMNS.TABLE_SCHEMA,</span><br><span class="line">      COLUMNS.TABLE_NAME,</span><br><span class="line">      COLUMNS.COLUMN_NAME,</span><br><span class="line">      UNIQUES.INDEX_NAME,</span><br><span class="line">      UNIQUES.COLUMN_NAMES,</span><br><span class="line">      UNIQUES.COUNT_COLUMN_IN_INDEX,</span><br><span class="line">      COLUMNS.DATA_TYPE,</span><br><span class="line">      COLUMNS.CHARACTER_SET_NAME,</span><br><span class="line">			<span class="keyword">LOCATE</span>(<span class="string">'auto_increment'</span>, EXTRA) &gt; <span class="number">0</span> <span class="keyword">as</span> is_auto_increment,</span><br><span class="line">      has_nullable</span><br><span class="line">    <span class="keyword">FROM</span> INFORMATION_SCHEMA.COLUMNS <span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line">      <span class="keyword">SELECT</span></span><br><span class="line">        TABLE_SCHEMA,</span><br><span class="line">        TABLE_NAME,</span><br><span class="line">        INDEX_NAME,</span><br><span class="line">        <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> COUNT_COLUMN_IN_INDEX,</span><br><span class="line">        <span class="keyword">GROUP_CONCAT</span>(COLUMN_NAME <span class="keyword">ORDER</span> <span class="keyword">BY</span> SEQ_IN_INDEX <span class="keyword">ASC</span>) <span class="keyword">AS</span> COLUMN_NAMES,</span><br><span class="line">        SUBSTRING_INDEX(<span class="keyword">GROUP_CONCAT</span>(COLUMN_NAME <span class="keyword">ORDER</span> <span class="keyword">BY</span> SEQ_IN_INDEX <span class="keyword">ASC</span>), <span class="string">','</span>, <span class="number">1</span>) <span class="keyword">AS</span> FIRST_COLUMN_NAME,</span><br><span class="line">        <span class="keyword">SUM</span>(NULLABLE=<span class="string">'YES'</span>) &gt; <span class="number">0</span> <span class="keyword">AS</span> has_nullable</span><br><span class="line">      <span class="keyword">FROM</span> INFORMATION_SCHEMA.STATISTICS</span><br><span class="line">      <span class="keyword">WHERE</span></span><br><span class="line">				NON_UNIQUE=<span class="number">0</span></span><br><span class="line">				<span class="keyword">AND</span> TABLE_SCHEMA = <span class="string">'test'</span></span><br><span class="line">      	<span class="keyword">AND</span> TABLE_NAME = <span class="string">'_employee1_gho'</span></span><br><span class="line">      <span class="keyword">GROUP</span> <span class="keyword">BY</span> TABLE_SCHEMA, TABLE_NAME, INDEX_NAME</span><br><span class="line">    ) <span class="keyword">AS</span> UNIQUES</span><br><span class="line">    <span class="keyword">ON</span> (</span><br><span class="line">      COLUMNS.COLUMN_NAME = UNIQUES.FIRST_COLUMN_NAME</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">      COLUMNS.TABLE_SCHEMA = <span class="string">'test'</span></span><br><span class="line">      <span class="keyword">AND</span> COLUMNS.TABLE_NAME = <span class="string">'_employee1_gho'</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">      COLUMNS.TABLE_SCHEMA, COLUMNS.TABLE_NAME,</span><br><span class="line">      <span class="keyword">CASE</span> UNIQUES.INDEX_NAME</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">'PRIMARY'</span> <span class="keyword">THEN</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">1</span></span><br><span class="line">      <span class="keyword">END</span>,</span><br><span class="line">      <span class="keyword">CASE</span> has_nullable</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">1</span></span><br><span class="line">      <span class="keyword">END</span>,</span><br><span class="line">      <span class="keyword">CASE</span> <span class="keyword">IFNULL</span>(CHARACTER_SET_NAME, <span class="string">''</span>)</span><br><span class="line">          <span class="keyword">WHEN</span> <span class="string">''</span> <span class="keyword">THEN</span> <span class="number">0</span></span><br><span class="line">          <span class="keyword">ELSE</span> <span class="number">1</span></span><br><span class="line">      <span class="keyword">END</span>,</span><br><span class="line">      <span class="keyword">CASE</span> DATA_TYPE</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">'tinyint'</span> <span class="keyword">THEN</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">'smallint'</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">'int'</span> <span class="keyword">THEN</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">'bigint'</span> <span class="keyword">THEN</span> <span class="number">3</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="number">100</span></span><br><span class="line">      <span class="keyword">END</span>,</span><br><span class="line">      COUNT_COLUMN_IN_INDEX</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.490030</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.490435</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">select</span></span><br><span class="line">				*</span><br><span class="line">			<span class="keyword">from</span></span><br><span class="line">				information_schema.columns</span><br><span class="line">			<span class="keyword">where</span></span><br><span class="line">				table_schema=<span class="string">'test'</span></span><br><span class="line">				<span class="keyword">and</span> table_name=<span class="string">'employee1'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.491220</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">select</span></span><br><span class="line">				*</span><br><span class="line">			<span class="keyword">from</span></span><br><span class="line">				information_schema.columns</span><br><span class="line">			<span class="keyword">where</span></span><br><span class="line">				table_schema=<span class="string">'test'</span></span><br><span class="line">				<span class="keyword">and</span> table_name=<span class="string">'employee1'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.491648</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">select</span></span><br><span class="line">				*</span><br><span class="line">			<span class="keyword">from</span></span><br><span class="line">				information_schema.columns</span><br><span class="line">			<span class="keyword">where</span></span><br><span class="line">				table_schema=<span class="string">'test'</span></span><br><span class="line">				<span class="keyword">and</span> table_name=<span class="string">'_employee1_gho'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.492166</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="string">`id`</span></span><br><span class="line">				<span class="keyword">from</span></span><br><span class="line">					<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">				<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">					<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">				<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.492369</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">select</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="string">`id`</span></span><br><span class="line">				<span class="keyword">from</span></span><br><span class="line">					<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">				<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">					<span class="string">`id`</span> <span class="keyword">desc</span></span><br><span class="line">				<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.492686</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.492707</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Threads_running'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.493066</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Threads_running'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.493758</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="string">'copy iteration 0 at 1590737908'</span>, <span class="string">'Copy: 0/10028 0.0%; Applied: 0; Backlog: 0/1000; Time: 0s(total), 0s(copy); streamer: bin.000070:320610958; State: migrating; ETA: N/A'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.592131</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:28.591944857+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.593200</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.692156</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:28.691988298+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.693217</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.792164</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:28.791963767+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.793212</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.892118</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:28.891946977+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.893150</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.992167</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:28.991978+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.993216</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.105879</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:29.105683131+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.105878</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.192162</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:29.191915709+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.193158</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.292151</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:29.291919747+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.293179</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.392095</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:29.391930285+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.393205</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.492159</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:29.491902668+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.493237</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.494187</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.494198</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40311</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.494760</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.494868</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40311</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.495139</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40311</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.495258</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40311</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.495265</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.495466</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.495702</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Threads_running'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.496312</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40311</span> <span class="keyword">Query</span>	<span class="keyword">select</span>  <span class="comment">/* gh-ost `test`.`employee1` iteration:0 */</span></span><br><span class="line">						<span class="string">`id`</span></span><br><span class="line">					<span class="keyword">from</span></span><br><span class="line">						<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">					<span class="keyword">where</span> ((<span class="string">`id`</span> &gt; _binary<span class="string">'1'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'1'</span>))) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">					<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">						<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">					<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">offset</span> <span class="number">999</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.496521</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="string">'copy iteration 0 at 1590737909'</span>, <span class="string">'Copy: 0/10028 0.0%; Applied: 0; Backlog: 0/1000; Time: 1s(total), 1s(copy); streamer: bin.000070:320618234; State: migrating; ETA: N/A'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.496554</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Threads_running'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.506595</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.507086</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40311</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.507153</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.507400</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">SET</span></span><br><span class="line">			<span class="keyword">SESSION</span> <span class="keyword">time_zone</span> = <span class="string">'SYSTEM'</span>,</span><br><span class="line">			sql_mode = <span class="keyword">CONCAT</span>(@@session.sql_mode, <span class="string">',STRICT_ALL_TABLES'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.507853</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> (<span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span>)</span><br><span class="line">      (<span class="keyword">select</span> <span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">force</span> <span class="keyword">index</span> (<span class="string">`PRIMARY`</span>)</span><br><span class="line">        <span class="keyword">where</span> (((<span class="string">`id`</span> &gt; _binary<span class="string">'1'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'1'</span>))) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'1000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'1000'</span>)))) <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span></span><br><span class="line">      )</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.523454</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">COMMIT</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.533501</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">select</span>  <span class="comment">/* gh-ost `test`.`employee1` iteration:1 */</span></span><br><span class="line">						<span class="string">`id`</span></span><br><span class="line">					<span class="keyword">from</span></span><br><span class="line">						<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">					<span class="keyword">where</span> ((<span class="string">`id`</span> &gt; _binary<span class="string">'1000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">					<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">						<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">					<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">offset</span> <span class="number">999</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.534075</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.534227</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">SET</span></span><br><span class="line">			<span class="keyword">SESSION</span> <span class="keyword">time_zone</span> = <span class="string">'SYSTEM'</span>,</span><br><span class="line">			sql_mode = <span class="keyword">CONCAT</span>(@@session.sql_mode, <span class="string">',STRICT_ALL_TABLES'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.534369</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> (<span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span>)</span><br><span class="line">      (<span class="keyword">select</span> <span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">force</span> <span class="keyword">index</span> (<span class="string">`PRIMARY`</span>)</span><br><span class="line">        <span class="keyword">where</span> (((<span class="string">`id`</span> &gt; _binary<span class="string">'1000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'2000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'2000'</span>)))) <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span></span><br><span class="line">      )</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.543074</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">COMMIT</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.586554</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">select</span>  <span class="comment">/* gh-ost `test`.`employee1` iteration:2 */</span></span><br><span class="line">						<span class="string">`id`</span></span><br><span class="line">					<span class="keyword">from</span></span><br><span class="line">						<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">					<span class="keyword">where</span> ((<span class="string">`id`</span> &gt; _binary<span class="string">'2000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">					<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">						<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">					<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">offset</span> <span class="number">999</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.587919</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.588183</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">SET</span></span><br><span class="line">			<span class="keyword">SESSION</span> <span class="keyword">time_zone</span> = <span class="string">'SYSTEM'</span>,</span><br><span class="line">			sql_mode = <span class="keyword">CONCAT</span>(@@session.sql_mode, <span class="string">',STRICT_ALL_TABLES'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.588485</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> (<span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span>)</span><br><span class="line">      (<span class="keyword">select</span> <span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">force</span> <span class="keyword">index</span> (<span class="string">`PRIMARY`</span>)</span><br><span class="line">        <span class="keyword">where</span> (((<span class="string">`id`</span> &gt; _binary<span class="string">'2000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'3000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'3000'</span>)))) <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span></span><br><span class="line">      )</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.591994</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:29.591866842+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.593465</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.593671</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.593802</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.593936</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.594077</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.602754</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> <span class="keyword">Query</span>	<span class="keyword">COMMIT</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.611800</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.612020</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">select</span>  <span class="comment">/* gh-ost `test`.`employee1` iteration:3 */</span></span><br><span class="line">						<span class="string">`id`</span></span><br><span class="line">					<span class="keyword">from</span></span><br><span class="line">						<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">					<span class="keyword">where</span> ((<span class="string">`id`</span> &gt; _binary<span class="string">'3000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">					<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">						<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">					<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">offset</span> <span class="number">999</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.612725</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.612883</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">SET</span></span><br><span class="line">			<span class="keyword">SESSION</span> <span class="keyword">time_zone</span> = <span class="string">'SYSTEM'</span>,</span><br><span class="line">			sql_mode = <span class="keyword">CONCAT</span>(@@session.sql_mode, <span class="string">',STRICT_ALL_TABLES'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.613169</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> (<span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span>)</span><br><span class="line">      (<span class="keyword">select</span> <span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">force</span> <span class="keyword">index</span> (<span class="string">`PRIMARY`</span>)</span><br><span class="line">        <span class="keyword">where</span> (((<span class="string">`id`</span> &gt; _binary<span class="string">'3000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'4000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'4000'</span>)))) <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span></span><br><span class="line">      )</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.629626</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">COMMIT</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.672734</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">select</span>  <span class="comment">/* gh-ost `test`.`employee1` iteration:4 */</span></span><br><span class="line">						<span class="string">`id`</span></span><br><span class="line">					<span class="keyword">from</span></span><br><span class="line">						<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">					<span class="keyword">where</span> ((<span class="string">`id`</span> &gt; _binary<span class="string">'4000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">					<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">						<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">					<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">offset</span> <span class="number">999</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.674106</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.674348</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">SET</span></span><br><span class="line">			<span class="keyword">SESSION</span> <span class="keyword">time_zone</span> = <span class="string">'SYSTEM'</span>,</span><br><span class="line">			sql_mode = <span class="keyword">CONCAT</span>(@@session.sql_mode, <span class="string">',STRICT_ALL_TABLES'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.674589</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> (<span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span>)</span><br><span class="line">      (<span class="keyword">select</span> <span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">force</span> <span class="keyword">index</span> (<span class="string">`PRIMARY`</span>)</span><br><span class="line">        <span class="keyword">where</span> (((<span class="string">`id`</span> &gt; _binary<span class="string">'4000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'5000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'5000'</span>)))) <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span></span><br><span class="line">      )</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.683215</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">COMMIT</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.688292</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">select</span>  <span class="comment">/* gh-ost `test`.`employee1` iteration:5 */</span></span><br><span class="line">						<span class="string">`id`</span></span><br><span class="line">					<span class="keyword">from</span></span><br><span class="line">						<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">					<span class="keyword">where</span> ((<span class="string">`id`</span> &gt; _binary<span class="string">'5000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">					<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">						<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">					<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">offset</span> <span class="number">999</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.688930</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.689193</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">SET</span></span><br><span class="line">			<span class="keyword">SESSION</span> <span class="keyword">time_zone</span> = <span class="string">'SYSTEM'</span>,</span><br><span class="line">			sql_mode = <span class="keyword">CONCAT</span>(@@session.sql_mode, <span class="string">',STRICT_ALL_TABLES'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.689449</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> (<span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span>)</span><br><span class="line">      (<span class="keyword">select</span> <span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">force</span> <span class="keyword">index</span> (<span class="string">`PRIMARY`</span>)</span><br><span class="line">        <span class="keyword">where</span> (((<span class="string">`id`</span> &gt; _binary<span class="string">'5000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'6000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'6000'</span>)))) <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span></span><br><span class="line">      )</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.692033</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:29.691873562+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.693417</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.693606</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.693715</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.693881</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.694047</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.706414</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> <span class="keyword">Query</span>	<span class="keyword">COMMIT</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.710002</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40309</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.710036</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Query</span>	<span class="keyword">select</span>  <span class="comment">/* gh-ost `test`.`employee1` iteration:6 */</span></span><br><span class="line">						<span class="string">`id`</span></span><br><span class="line">					<span class="keyword">from</span></span><br><span class="line">						<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">					<span class="keyword">where</span> ((<span class="string">`id`</span> &gt; _binary<span class="string">'6000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">					<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">						<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">					<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">offset</span> <span class="number">999</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.710568</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.710719</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">SET</span></span><br><span class="line">			<span class="keyword">SESSION</span> <span class="keyword">time_zone</span> = <span class="string">'SYSTEM'</span>,</span><br><span class="line">			sql_mode = <span class="keyword">CONCAT</span>(@@session.sql_mode, <span class="string">',STRICT_ALL_TABLES'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.710962</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> (<span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span>)</span><br><span class="line">      (<span class="keyword">select</span> <span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">force</span> <span class="keyword">index</span> (<span class="string">`PRIMARY`</span>)</span><br><span class="line">        <span class="keyword">where</span> (((<span class="string">`id`</span> &gt; _binary<span class="string">'6000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'7000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'7000'</span>)))) <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span></span><br><span class="line">      )</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.720031</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">COMMIT</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.724876</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Query</span>	<span class="keyword">select</span>  <span class="comment">/* gh-ost `test`.`employee1` iteration:7 */</span></span><br><span class="line">						<span class="string">`id`</span></span><br><span class="line">					<span class="keyword">from</span></span><br><span class="line">						<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">					<span class="keyword">where</span> ((<span class="string">`id`</span> &gt; _binary<span class="string">'7000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">					<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">						<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">					<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">offset</span> <span class="number">999</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.725421</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.725689</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">SET</span></span><br><span class="line">			<span class="keyword">SESSION</span> <span class="keyword">time_zone</span> = <span class="string">'SYSTEM'</span>,</span><br><span class="line">			sql_mode = <span class="keyword">CONCAT</span>(@@session.sql_mode, <span class="string">',STRICT_ALL_TABLES'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.725942</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> (<span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span>)</span><br><span class="line">      (<span class="keyword">select</span> <span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">force</span> <span class="keyword">index</span> (<span class="string">`PRIMARY`</span>)</span><br><span class="line">        <span class="keyword">where</span> (((<span class="string">`id`</span> &gt; _binary<span class="string">'7000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'8000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'8000'</span>)))) <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span></span><br><span class="line">      )</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.748448</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">COMMIT</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.754426</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Query</span>	<span class="keyword">select</span>  <span class="comment">/* gh-ost `test`.`employee1` iteration:8 */</span></span><br><span class="line">						<span class="string">`id`</span></span><br><span class="line">					<span class="keyword">from</span></span><br><span class="line">						<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">					<span class="keyword">where</span> ((<span class="string">`id`</span> &gt; _binary<span class="string">'8000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">					<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">						<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">					<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">offset</span> <span class="number">999</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.755265</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.755448</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">SET</span></span><br><span class="line">			<span class="keyword">SESSION</span> <span class="keyword">time_zone</span> = <span class="string">'SYSTEM'</span>,</span><br><span class="line">			sql_mode = <span class="keyword">CONCAT</span>(@@session.sql_mode, <span class="string">',STRICT_ALL_TABLES'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.755605</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> (<span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span>)</span><br><span class="line">      (<span class="keyword">select</span> <span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">force</span> <span class="keyword">index</span> (<span class="string">`PRIMARY`</span>)</span><br><span class="line">        <span class="keyword">where</span> (((<span class="string">`id`</span> &gt; _binary<span class="string">'8000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'9000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'9000'</span>)))) <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span></span><br><span class="line">      )</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.766785</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">COMMIT</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.770199</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Query</span>	<span class="keyword">select</span>  <span class="comment">/* gh-ost `test`.`employee1` iteration:9 */</span></span><br><span class="line">						<span class="string">`id`</span></span><br><span class="line">					<span class="keyword">from</span></span><br><span class="line">						<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">					<span class="keyword">where</span> ((<span class="string">`id`</span> &gt; _binary<span class="string">'9000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">					<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">						<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">					<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">offset</span> <span class="number">999</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.770741</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.770860</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">SET</span></span><br><span class="line">			<span class="keyword">SESSION</span> <span class="keyword">time_zone</span> = <span class="string">'SYSTEM'</span>,</span><br><span class="line">			sql_mode = <span class="keyword">CONCAT</span>(@@session.sql_mode, <span class="string">',STRICT_ALL_TABLES'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.771014</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> (<span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span>)</span><br><span class="line">      (<span class="keyword">select</span> <span class="string">`id`</span>, <span class="string">`employeeid`</span>, <span class="string">`employeename`</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">force</span> <span class="keyword">index</span> (<span class="string">`PRIMARY`</span>)</span><br><span class="line">        <span class="keyword">where</span> (((<span class="string">`id`</span> &gt; _binary<span class="string">'9000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))) <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span></span><br><span class="line">      )</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.778317</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">COMMIT</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.781554</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Query</span>	<span class="keyword">select</span>  <span class="comment">/* gh-ost `test`.`employee1` iteration:10 */</span></span><br><span class="line">						<span class="string">`id`</span></span><br><span class="line">					<span class="keyword">from</span></span><br><span class="line">						<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">					<span class="keyword">where</span> ((<span class="string">`id`</span> &gt; _binary<span class="string">'10000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">					<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">						<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">					<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">offset</span> <span class="number">999</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.781810</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">select</span> <span class="comment">/* gh-ost `test`.`employee1` iteration:10 */</span> <span class="string">`id`</span></span><br><span class="line">				<span class="keyword">from</span> (</span><br><span class="line">					<span class="keyword">select</span></span><br><span class="line">							<span class="string">`id`</span></span><br><span class="line">						<span class="keyword">from</span></span><br><span class="line">							<span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line">						<span class="keyword">where</span> ((<span class="string">`id`</span> &gt; _binary<span class="string">'10000'</span>)) <span class="keyword">and</span> ((<span class="string">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="string">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">						<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">							<span class="string">`id`</span> <span class="keyword">asc</span></span><br><span class="line">						<span class="keyword">limit</span> <span class="number">1000</span></span><br><span class="line">				) select_osc_chunk</span><br><span class="line">			<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">				<span class="string">`id`</span> <span class="keyword">desc</span></span><br><span class="line">			<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.782135</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="string">'copy iteration 10 at 1590737909'</span>, <span class="string">'Copy: 10000/10000 100.0%; Applied: 0; Backlog: 0/1000; Time: 1s(total), 1s(copy); streamer: bin.000070:320813452; State: migrating; ETA: due'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.784806</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.785567</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">select</span> connection_id()</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.785720</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">select</span> <span class="keyword">get_lock</span>(<span class="string">'gh-ost.40312.lock'</span>, <span class="number">0</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.785846</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">set</span> <span class="keyword">session</span> lock_wait_timeout:=<span class="number">6</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.791062</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">status</span> <span class="keyword">from</span> <span class="string">`test`</span> <span class="keyword">like</span> <span class="string">'_employee1_del'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.791374</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> <span class="keyword">Query</span>	<span class="keyword">create</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="string">`test`</span>.<span class="string">`_employee1_del`</span> (</span><br><span class="line">			<span class="keyword">id</span> <span class="built_in">int</span> auto_increment primary <span class="keyword">key</span></span><br><span class="line">		) <span class="keyword">engine</span>=<span class="keyword">InnoDB</span> <span class="keyword">comment</span>=<span class="string">'ghost-cut-over-sentry'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.792202</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.793355</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.793370</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.793452</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.793460</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.793515</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.793610</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.793646</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:29.791855122+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.793942</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.794103</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.807138</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.807226</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">lock</span> <span class="comment">/* gh-ost */</span> <span class="keyword">tables</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> write, <span class="string">`test`</span>.<span class="string">`_employee1_del`</span> write</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.807813</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">2</span>, <span class="number">0</span>), <span class="string">'state'</span>, <span class="string">'AllEventsUpToLockProcessed:1590737909807671836'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.810430</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="string">'state at 1590737909810266435'</span>, <span class="string">'AllEventsUpToLockProcessed:1590737909807671836'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.892168</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:29.891967268+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.893179</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.992165</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:29.991965407+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.993199</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.092194</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:30.091928438+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.093227</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.192141</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:30.191949581+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.193143</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.292137</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:30.291941416+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.293149</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.392240</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:30.392035339+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.393275</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.492165</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:30.491972791+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.493176</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.493939</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.494139</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.494249</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.494318</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.494385</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Threads_running'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.494988</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Threads_running'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.495802</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40315</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.496482</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="string">'copy iteration 10 at 1590737910'</span>, <span class="string">'Copy: 10000/10000 100.0%; Applied: 0; Backlog: 1/1000; Time: 2s(total), 1s(copy); streamer: bin.000070:320823747; State: migrating; ETA: due'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.592238</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:30.591999354+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.593255</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.692187</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:30.691992755+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.693206</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.782521</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="string">'copy iteration 10 at 1590737910'</span>, <span class="string">'Copy: 10000/10000 100.0%; Applied: 0; Backlog: 0/1000; Time: 2s(total), 1s(copy); streamer: bin.000070:320825878; State: migrating; ETA: due'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.792059</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:30.791873789+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.792295</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.792439</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">select</span> connection_id()</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.792794</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">set</span> <span class="keyword">session</span> lock_wait_timeout:=<span class="number">3</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793033</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793157</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793316</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793423</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793585</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">select</span> <span class="keyword">id</span></span><br><span class="line">			<span class="keyword">from</span> information_schema.processlist</span><br><span class="line">			<span class="keyword">where</span></span><br><span class="line">				<span class="keyword">id</span> != connection_id()</span><br><span class="line">				<span class="keyword">and</span> <span class="number">40314</span> <span class="keyword">in</span> (<span class="number">0</span>, <span class="keyword">id</span>)</span><br><span class="line">				<span class="keyword">and</span> state <span class="keyword">like</span> <span class="keyword">concat</span>(<span class="string">'%'</span>, <span class="string">'metadata lock'</span>, <span class="string">'%'</span>)</span><br><span class="line">				<span class="keyword">and</span> info  <span class="keyword">like</span> <span class="keyword">concat</span>(<span class="string">'%'</span>, <span class="string">'rename'</span>, <span class="string">'%'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793827</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">rename</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">to</span> <span class="string">`test`</span>.<span class="string">`_employee1_del`</span>, <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> <span class="keyword">to</span> <span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.794321</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.794490</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.794641</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.795166</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.795347</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.796006</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.892133</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:30.891962913+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.893297</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.992155</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:30.991958953+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.993278</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.092115</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:31.091945166+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.093206</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.192121</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:31.191943104+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.193195</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.292113</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:31.291920755+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.293131</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.392166</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:31.391927846+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.393211</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.492258</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:31.491963265+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.493225</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.493639</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Threads_running'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.494432</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Threads_running'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.496602</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="string">'copy iteration 10 at 1590737911'</span>, <span class="string">'Copy: 10000/10000 100.0%; Applied: 0; Backlog: 0/1000; Time: 3s(total), 1s(copy); streamer: bin.000070:320832073; State: migrating; ETA: due'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.592213</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:31.592016295+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.593217</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.692115</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:31.691941596+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.693157</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.792078</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:31.791911518+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.793129</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">select</span> hint, <span class="keyword">value</span> <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> <span class="keyword">where</span> hint = <span class="string">'heartbeat'</span> <span class="keyword">and</span> <span class="keyword">id</span> &lt;= <span class="number">255</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.794412</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">select</span> <span class="keyword">id</span></span><br><span class="line">			<span class="keyword">from</span> information_schema.processlist</span><br><span class="line">			<span class="keyword">where</span></span><br><span class="line">				<span class="keyword">id</span> != connection_id()</span><br><span class="line">				<span class="keyword">and</span> <span class="number">40314</span> <span class="keyword">in</span> (<span class="number">0</span>, <span class="keyword">id</span>)</span><br><span class="line">				<span class="keyword">and</span> state <span class="keyword">like</span> <span class="keyword">concat</span>(<span class="string">'%'</span>, <span class="string">'metadata lock'</span>, <span class="string">'%'</span>)</span><br><span class="line">				<span class="keyword">and</span> info  <span class="keyword">like</span> <span class="keyword">concat</span>(<span class="string">'%'</span>, <span class="string">'rename'</span>, <span class="string">'%'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.794952</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">select</span> <span class="keyword">is_used_lock</span>(<span class="string">'gh-ost.40312.lock'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.795148</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">drop</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`test`</span>.<span class="string">`_employee1_del`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.804223</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">unlock</span> <span class="keyword">tables</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.804366</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">ROLLBACK</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.804450</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.828578</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">ROLLBACK</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.828661</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">status</span> <span class="keyword">from</span> <span class="string">`test`</span> <span class="keyword">like</span> <span class="string">'_employee1_del'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.829299</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.892061</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:31.891916935+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.895474</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">drop</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.903826</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">drop</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`test`</span>.<span class="string">`_employee1_del`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.927905</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.927992</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40307</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.928011</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40308</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.928082</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> Quit</span><br></pre></td></tr></table></figure></p>
<h3 id="执行过程解析"><a href="#执行过程解析" class="headerlink" title="执行过程解析"></a>执行过程解析</h3><h4 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h4><p>检查用户、权限、binlog信息、字符集、复制状态、表状态等<br><br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.796759</span>+<span class="number">08:00	40303</span> Connect	root@<span class="number">127.0.0.1</span> on test using TCP/IP</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.796967</span>+<span class="number">08:00	40303</span> Query	SELECT @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.797151+08</span>:<span class="number">00	40303</span> Query	SET autocommit=true</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.797283</span>+<span class="number">08:00	40303</span> Query	SET NAMES utf8mb4</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.797446</span>+<span class="number">08:00	40303</span> Query	select @@global.version</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.797751</span>+<span class="number">08:00	40303</span> Query	select @@global.port</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.797976</span>+<span class="number">08:00	40303</span> Query	select @@global.hostname, @@global.port</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.798176+08</span>:<span class="number">00	40303</span> Query	show /* gh-ost */ grants for current_user()</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.798307</span>+<span class="number">08:00	40303</span> Query	select @@global.log_bin, @@global.binlog_format</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.798396</span>+<span class="number">08:00	40303</span> Query	select @@global.binlog_row_image</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.799003</span>+<span class="number">08:00	40304</span> Connect	root@<span class="number">127.0.0.1</span> on information_schema using TCP/IP</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.799177+08</span>:<span class="number">00	40304</span> Query	SELECT @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.799343</span>+<span class="number">08:00	40304</span> Query	SET autocommit=true</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.799460</span>+<span class="number">08:00	40304</span> Query	SET NAMES utf8mb4</span><br><span class="line"><span class="number">2018</span>-<span class="number">10-11T15:38</span>:<span class="number">27.799571</span>+<span class="number">08:00	40304</span> Query	show slave status</span><br></pre></td></tr></table></figure></p>
<p>检查外键、触发器、行数预估、索引、字段等信息<br><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2018-10-11T15:38:27.800450+08:00	40303 Query	<span class="keyword">SELECT</span></span><br><span class="line">			<span class="keyword">SUM</span>(REFERENCED_TABLE_NAME <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">AND</span> TABLE_SCHEMA=<span class="string">'test'</span> <span class="keyword">AND</span> TABLE_NAME=<span class="string">'employee1'</span>) <span class="keyword">as</span> num_child_side_fk,......</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.328510</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> num_triggers......</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.334174</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">explain</span> <span class="keyword">select</span> <span class="comment">/* gh-ost */</span> * <span class="keyword">from</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">where</span> <span class="number">1</span>=<span class="number">1.</span>.....</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.359593</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span></span><br><span class="line">      COLUMNS.TABLE_SCHEMA,......</span><br></pre></td></tr></table></figure></p>
<h4 id="伪装slave"><a href="#伪装slave" class="headerlink" title="伪装slave"></a>伪装slave</h4><p>模拟 slave，获取当前的位点信息，创建 binlog streamer 监听 binlog<br><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2018-10-11T15:38:28.364408+08:00	40303 Query	<span class="keyword">show</span> <span class="comment">/* gh-ost readCurrentBinlogCoordinates */</span> <span class="keyword">master</span> <span class="keyword">status</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.365328</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40306</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span>  <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.365632</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40306</span> <span class="keyword">Query</span>	<span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'BINLOG_CHECKSUM'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.366882</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40306</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> @master_binlog_checksum=<span class="string">'NONE'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.367450</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40306</span> <span class="keyword">Binlog</span> Dump	<span class="keyword">Log</span>: <span class="string">'bin.000070'</span>  Pos: <span class="number">320607755</span></span><br></pre></td></tr></table></figure></p>
<h4 id="创建日志记录表-xx-ghc-和影子表-xx-gho-并且执行-alter-语句将影子表变更为目标表结构"><a href="#创建日志记录表-xx-ghc-和影子表-xx-gho-并且执行-alter-语句将影子表变更为目标表结构" class="headerlink" title="创建日志记录表 xx_ghc 和影子表 xx_gho 并且执行 alter 语句将影子表变更为目标表结构"></a>创建日志记录表 xx_ghc 和影子表 xx_gho 并且执行 alter 语句将影子表变更为目标表结构</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2018-10-11T15:38:28.385496+08:00	40303 Query	<span class="keyword">create</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span> (</span><br><span class="line">			<span class="keyword">id</span> <span class="built_in">bigint</span> auto_increment,</span><br><span class="line">			last_update <span class="keyword">timestamp</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">			hint <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">charset</span> <span class="keyword">ascii</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">			<span class="keyword">value</span> <span class="built_in">varchar</span>(<span class="number">4096</span>) <span class="keyword">charset</span> <span class="keyword">ascii</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">			primary <span class="keyword">key</span>(<span class="keyword">id</span>),</span><br><span class="line">			<span class="keyword">unique</span> <span class="keyword">key</span> hint_uidx(hint)</span><br><span class="line">		) auto_increment=<span class="number">256</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.419446</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">create</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> <span class="keyword">like</span> <span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.445917</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">alter</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> <span class="keyword">engine</span>=<span class="keyword">innodb</span></span><br></pre></td></tr></table></figure>
<h4 id="insert-into-xx-gho-select-from-xx-拷贝数据"><a href="#insert-into-xx-gho-select-from-xx-拷贝数据" class="headerlink" title="insert into xx_gho select * from xx 拷贝数据"></a>insert into xx_gho select * from xx 拷贝数据</h4><p>同时从general_log中可以相关的步骤会记录到xx_ghc表中，其中包括GhostTableMigrated，heartbeat等信息，并且此类信息会贯穿DDL整个周期内<br><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">2018-10-11T15:38:28.480994+08:00	40303 Query	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">2</span>, <span class="number">0</span>), <span class="string">'state'</span>, <span class="string">'GhostTableMigrated'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.483727</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="string">'state at 1590737908483609931'</span>, <span class="string">'GhostTableMigrated'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">28.487362</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40303</span> <span class="keyword">Query</span>	<span class="keyword">insert</span> <span class="comment">/* gh-ost */</span> <span class="keyword">into</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line">				(<span class="keyword">id</span>, hint, <span class="keyword">value</span>)</span><br><span class="line">			<span class="keyword">values</span></span><br><span class="line">				(<span class="keyword">NULLIF</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="string">'heartbeat'</span>, <span class="string">'2018-10-11T15:38:28.487157014+08:00'</span>)</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span></span><br><span class="line">				last_update=<span class="keyword">NOW</span>(),</span><br><span class="line">				<span class="keyword">value</span>=<span class="keyword">VALUES</span>(<span class="keyword">value</span>)</span><br><span class="line">......</span><br></pre></td></tr></table></figure></p>
<p>紧接着获取获取当前的最大主键和最小主键，然后根据命令行传参 chunk 获取数据 ，开启事务，insert 到影子表里面，循环此步骤，直到数据copy完成<br><br>rowcopy 过程中是对原表加上 lock in share mode,防止数据在 copy 的过程中被修改<br><br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">2018-10<span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.496312</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40311</span> Query	<span class="keyword">select</span>  <span class="comment">/* gh-ost `test`.`employee1` iteration:0 */</span></span><br><span class="line">						<span class="symbol">`id`</span></span><br><span class="line">					<span class="keyword">from</span></span><br><span class="line">						<span class="symbol">`test`</span>.<span class="symbol">`employee1`</span></span><br><span class="line">					<span class="keyword">where</span> ((<span class="symbol">`id`</span> &gt; _binary<span class="string">'1'</span>) <span class="keyword">or</span> ((<span class="symbol">`id`</span> = _binary<span class="string">'1'</span>))) <span class="keyword">and</span> ((<span class="symbol">`id`</span> &lt; _binary<span class="string">'10000'</span>) <span class="keyword">or</span> ((<span class="symbol">`id`</span> = _binary<span class="string">'10000'</span>)))</span><br><span class="line">					<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">						<span class="symbol">`id`</span> <span class="keyword">asc</span></span><br><span class="line">					<span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">					<span class="keyword">offset</span> <span class="number">999</span></span><br><span class="line">......</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.507153</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> Query	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.507400</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> Query	<span class="keyword">SET</span></span><br><span class="line">			SESSION time_zone = <span class="string">'SYSTEM'</span>,</span><br><span class="line">			sql_mode = CONCAT(@@session.sql_mode, <span class="string">',STRICT_ALL_TABLES'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.507853</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> Query	<span class="keyword">insert</span> <span class="comment">/* gh-ost `test`.`employee1` */</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="symbol">`test`</span>.<span class="symbol">`_employee1_gho`</span> (<span class="symbol">`id`</span>, <span class="symbol">`employeeid`</span>, <span class="symbol">`employeename`</span>)</span><br><span class="line">      (<span class="keyword">select</span> <span class="symbol">`id`</span>, <span class="symbol">`employeeid`</span>, <span class="symbol">`employeename`</span> <span class="keyword">from</span> <span class="symbol">`test`</span>.<span class="symbol">`employee1`</span> <span class="keyword">force</span> <span class="keyword">index</span> (<span class="symbol">`PRIMARY`</span>)</span><br><span class="line">        <span class="keyword">where</span> (((<span class="symbol">`id`</span> &gt; _binary<span class="string">'1'</span>) <span class="keyword">or</span> ((<span class="symbol">`id`</span> = _binary<span class="string">'1'</span>))) <span class="keyword">and</span> ((<span class="symbol">`id`</span> &lt; _binary<span class="string">'1000'</span>) <span class="keyword">or</span> ((<span class="symbol">`id`</span> = _binary<span class="string">'1000'</span>)))) lock <span class="keyword">in</span> share mode</span><br><span class="line">      )</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.523454</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40310</span> Query	<span class="keyword">COMMIT</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure></p>
<h4 id="应用增量数据"><a href="#应用增量数据" class="headerlink" title="应用增量数据"></a>应用增量数据</h4><p>由于测试环境在做DDL期间，没有增量数据写入，general_log并没有读取binlog相关的信息<br></p>
<ul>
<li>row copy 转化为insert ignore into 到影子表</li>
<li>apply binlog 转化为replace into 应用到影子表</li>
</ul>
<h4 id="创建xx-del表"><a href="#创建xx-del表" class="headerlink" title="创建xx_del表"></a>创建xx_del表</h4><p>防止 cut-over 提前执行，导致数据丢失。最后做影子表和原表的交换及收尾工作<br><br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.791374</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40313</span> Query	create <span class="comment">/* gh-ost */</span> table `test`.`_employee1_del` (</span><br><span class="line">			id int auto_increment primary key</span><br><span class="line">		) engine=InnoDB comment=<span class="string">'ghost-cut-over-sentry'</span>......</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.807226</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> Query	lock <span class="comment">/* gh-ost */</span> tables `test`.`employee1` write, `test`.`_employee1_del` write......</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793827</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> Query	rename <span class="comment">/* gh-ost */</span> table `test`.`employee1` to `test`.`_employee1_del`, `test`.`_employee1_gho` to `test`.`employee1`......</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.795148</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> Query	drop <span class="comment">/* gh-ost */</span> table <span class="keyword">if</span> exists `test`.`_employee1_del`</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.804223</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> Query	unlock tables......</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.895474</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> Query	drop <span class="comment">/* gh-ost */</span> table <span class="keyword">if</span> exists `test`.`_employee1_ghc`</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.903826</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> Query	drop <span class="comment">/* gh-ost */</span> table <span class="keyword">if</span> exists `test`.`_employee1_del`</span><br></pre></td></tr></table></figure></p>
<h3 id="执行过程总结"><a href="#执行过程总结" class="headerlink" title="执行过程总结"></a>执行过程总结</h3><ul>
<li>① 检查有没有外键和触发器</li>
<li>② 检查表的主键信息</li>
<li>③ 检查是否主库或从库，是否开启log_slave_updates，以及binlog信息  </li>
<li>④ 检查gho和del结尾的临时表是否存在</li>
<li>⑤ 创建ghc结尾的表，存数据迁移的信息，以及binlog信息等    </li>
<li>⑥ 初始化stream的连接,添加binlog的监听</li>
<li>⑥ 创建gho结尾的临时表，执行DDL在gho结尾的临时表上</li>
<li>⑦ 开启事务，按照主键id把源表数据写入到gho结尾的表上，再提交，以及binlog apply</li>
<li>⑧ lock源表，rename 表：rename 源表 to 源_del表，gho表 to 源表</li>
<li>⑨ 清理ghc表</li>
</ul>
<h2 id="gh-ost-操作模式"><a href="#gh-ost-操作模式" class="headerlink" title="gh-ost 操作模式"></a>gh-ost 操作模式</h2><p>gh-ost 可以同时连接多个服务器，为了获取二进制的数据流，它会作为一个从库，将数据从一个库复制到另外一个。它有各种不同的操作模式，这取决于你的设置，配置，和要运行迁移环境。<br><br><img src="http://qanp7f2om.bkt.clouddn.com/gh-ost02.png" alt="image"></p>
<h3 id="连接到从库，在主库做迁移"><a href="#连接到从库，在主库做迁移" class="headerlink" title="连接到从库，在主库做迁移"></a>连接到从库，在主库做迁移</h3><p>这是 gh-ost 默认的工作方式。gh-ost 将会检查从库状态，找到集群结构中的主库并连接，接下来进行迁移操作：<br></p>
<ul>
<li>行数据在主库上读写</li>
<li>读取从库的二进制日志，将变更应用到主库</li>
<li>在从库收集表格式，字段&amp;索引，行数等信息</li>
<li>在从库上读取内部的变更事件（如心跳事件）</li>
<li>在主库切换表</li>
</ul>
<p>如果你的主库的日志格式是 SBR，工具也可以正常工作。但从库必须启用二级制日志(log_bin, log_slave_updates) 并且设置 binlog_format=ROW ( gh-ost 是读取从库的二级制文件)。</p>
<p>如果直接在主库上操作，当然也需要二进制日志格式是RBR。</p>
<h3 id="连接到主库"><a href="#连接到主库" class="headerlink" title="连接到主库"></a>连接到主库</h3><p>如果你没有从库，或者不想使用从库，你可以直接在主库上操作。gh-ost 将会直接在主库上进行所有操作。你需要持续关注<font color="FF0000">复制延迟</font>问题。<br></p>
<ul>
<li>主库的二进制日志必须是 RBR 格式</li>
<li>必须指定 –allow-on-master 参数</li>
</ul>
<h3 id="在从库迁移-测试"><a href="#在从库迁移-测试" class="headerlink" title="在从库迁移/测试"></a>在从库迁移/测试</h3><p>该模式会在从库执行迁移操作。gh-ost 会简单的连接到主库，此后所有的操作都在从库执行，不会对主库进行任何的改动。整个操作过程中，gh-ost 将控制速度保证从库可以及时的进行数据同步<br></p>
<ul>
<li>–migrate-on-replica 表示 gh-ost 会直接在从库上进行迁移操作。即使在复制运行阶段也可以进行表的切换操作</li>
<li>–test-on-replica 表示 迁移操作只是为了测试在切换之前复制会停止，然后会进行切换操作，然后在切换回来，你的原始表最终还是原始表。两个表都会保存下来，复制操作是停止的。你可以对这两个表进行一致性检查等测试操作</li>
</ul>
<h2 id="时序问题"><a href="#时序问题" class="headerlink" title="时序问题"></a>时序问题</h2><p>gh-ost 做 DDL 变更期间对原表和影子表的操作有三种:<br><br>对原表的 row copy (我们用 A 操作代替),业务对原表的 DML 操作(B),对影子表的 apply binlog(C)。而且 binlog 是基于 DML 操作产生的，因此对影子表的 apply binlog 一定在 对原表的 DML 之后，共有ABC/BCA/BAC/三种<br></p>
<table>
<thead>
<tr>
<th>类别</th>
<th>row copy(A)</th>
<th>DML(B)</th>
<th>apply binlog(C)</th>
</tr>
</thead>
<tbody>
<tr>
<td>A-B-C，数据先被复制到影子表</td>
<td>insert ignore into b select id&gt;0 and id&lt;3;<br>将数据从原表同步到影子表</td>
<td>insert into b(id,val) values(2,’b’);<br>update b set val=’b’ where id = 1;<br>delete from b where id = 1;</td>
<td>replace into b(id,val) values(2,’b’);<br>update b set val=’b’ where id = 1;<br>delete from b where id = 1;</td>
</tr>
<tr>
<td>B-C-A，先应用dml的binlog，数据后被复制到影子表</td>
<td>insert into b(id,val) values(2,’a’);<br>update b set val=’b’ where id = 1;<br>delete from b where id = 1;</td>
<td>replace into b(id,val) values(2,’a’);<br>update b set val=’b’ where id = 1;影子表不存在此记录，update空;<br>delete from b where id = 1;影子表不存在此记录，delete空;</td>
<td>因为id=2的记录binlog比row copy先到达，row copy执行insert ignore忽略插入;<br>row copy时新记录已经在原表，直接复制到影子表即可;<br>row copy时原表已无此记录，不会同步到影子表</td>
</tr>
<tr>
<td>B-A-C，先插入dml，数据再被复制到影子表，最后应用dml</td>
<td>insert into b(id,val) values(2,’a’);<br>update b set val=’b’ where id =1;<br>delete from b where id = 1;</td>
<td>insert ignore into b(id,val) values(2,’a’);<br>insert ignore into b(id,val) values(1,’b’);<br>因为id=1的记录已经被删除，row copy空行;</td>
<td>因为id=2的记录row copy比binlog先到达，影子表已经有id=2记录，apply binlog会使用replace into;<br>因为id=2的记录row copy比binlog先到达，binlog apply执行update…<br>binlog apply空操作</td>
</tr>
</tbody>
</table>
<p>通过上面的几种组合操作的分析，我们可以看到 数据最终是一致的。尤其是当copy 结束之后，只剩下apply binlog，情况更简单。</p>
<h2 id="cut-over原理"><a href="#cut-over原理" class="headerlink" title="cut-over原理"></a>cut-over原理</h2><h3 id="general-log-1"><a href="#general-log-1" class="headerlink" title="general_log"></a>general_log</h3><p>从上面的general_log，截取后面的cut-over：<br><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">2018-10-11T15:38:29.791374+08:00	40313 Query	<span class="keyword">create</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="string">`test`</span>.<span class="string">`_employee1_del`</span> (</span><br><span class="line">			<span class="keyword">id</span> <span class="built_in">int</span> auto_increment primary <span class="keyword">key</span></span><br><span class="line">		) <span class="keyword">engine</span>=<span class="keyword">InnoDB</span> <span class="keyword">comment</span>=<span class="string">'ghost-cut-over-sentry'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">29.807226</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">lock</span> <span class="comment">/* gh-ost */</span> <span class="keyword">tables</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> write, <span class="string">`test`</span>.<span class="string">`_employee1_del`</span> write</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.493939</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.494139</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.494249</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.494318</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.494385</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40316</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Threads_running'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.494988</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Threads_running'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.792295</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">START</span> <span class="keyword">TRANSACTION</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.792439</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">select</span> connection_id()</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.792794</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">set</span> <span class="keyword">session</span> lock_wait_timeout:=<span class="number">3</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793033</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Connect</span>	root@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="keyword">on</span> <span class="keyword">test</span> <span class="keyword">using</span> TCP/IP</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793157</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">SELECT</span> @@max_allowed_packet</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793316</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> autocommit=<span class="literal">true</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793423</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793585</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">select</span> <span class="keyword">id</span></span><br><span class="line">			<span class="keyword">from</span> information_schema.processlist</span><br><span class="line">			<span class="keyword">where</span></span><br><span class="line">				<span class="keyword">id</span> != connection_id()</span><br><span class="line">				<span class="keyword">and</span> <span class="number">40314</span> <span class="keyword">in</span> (<span class="number">0</span>, <span class="keyword">id</span>)</span><br><span class="line">				<span class="keyword">and</span> state <span class="keyword">like</span> <span class="keyword">concat</span>(<span class="string">'%'</span>, <span class="string">'metadata lock'</span>, <span class="string">'%'</span>)</span><br><span class="line">				<span class="keyword">and</span> info  <span class="keyword">like</span> <span class="keyword">concat</span>(<span class="string">'%'</span>, <span class="string">'rename'</span>, <span class="string">'%'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">30.793827</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">rename</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="string">`test`</span>.<span class="string">`employee1`</span> <span class="keyword">to</span> <span class="string">`test`</span>.<span class="string">`_employee1_del`</span>, <span class="string">`test`</span>.<span class="string">`_employee1_gho`</span> <span class="keyword">to</span> <span class="string">`test`</span>.<span class="string">`employee1`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.493639</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Threads_running'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.494432</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">'Threads_running'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.794412</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">select</span> <span class="keyword">id</span></span><br><span class="line">			<span class="keyword">from</span> information_schema.processlist</span><br><span class="line">			<span class="keyword">where</span></span><br><span class="line">				<span class="keyword">id</span> != connection_id()</span><br><span class="line">				<span class="keyword">and</span> <span class="number">40314</span> <span class="keyword">in</span> (<span class="number">0</span>, <span class="keyword">id</span>)</span><br><span class="line">				<span class="keyword">and</span> state <span class="keyword">like</span> <span class="keyword">concat</span>(<span class="string">'%'</span>, <span class="string">'metadata lock'</span>, <span class="string">'%'</span>)</span><br><span class="line">				<span class="keyword">and</span> info  <span class="keyword">like</span> <span class="keyword">concat</span>(<span class="string">'%'</span>, <span class="string">'rename'</span>, <span class="string">'%'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.794952</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">select</span> <span class="keyword">is_used_lock</span>(<span class="string">'gh-ost.40312.lock'</span>)</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.795148</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">drop</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`test`</span>.<span class="string">`_employee1_del`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.804223</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">unlock</span> <span class="keyword">tables</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.804366</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> <span class="keyword">Query</span>	<span class="keyword">ROLLBACK</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.804450</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40312</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.828578</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">ROLLBACK</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.828661</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> <span class="keyword">Query</span>	<span class="keyword">show</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">status</span> <span class="keyword">from</span> <span class="string">`test`</span> <span class="keyword">like</span> <span class="string">'_employee1_del'</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.829299</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40318</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.895474</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> <span class="keyword">Query</span>	<span class="keyword">drop</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`test`</span>.<span class="string">`_employee1_ghc`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.903826</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> <span class="keyword">Query</span>	<span class="keyword">drop</span> <span class="comment">/* gh-ost */</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="string">`test`</span>.<span class="string">`_employee1_del`</span></span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.927905</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40314</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.927992</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40307</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.928011</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40308</span> Quit	</span><br><span class="line"><span class="number">2018</span><span class="number">-10</span><span class="number">-11</span>T15:<span class="number">38</span>:<span class="number">31.928082</span>+<span class="number">08</span>:<span class="number">00</span>	<span class="number">40317</span> Quit</span><br></pre></td></tr></table></figure></p>
<h3 id="日志说明"><a href="#日志说明" class="headerlink" title="日志说明"></a>日志说明</h3><p>其中，包括session:<br></p>
<ul>
<li>T1-40313:create table _employee1_del</li>
<li>T2-40312:lock tables employee1 write, _employee1_del write</li>
<li>T3-40316:show global status like ‘Threads_running’</li>
<li>T4-40317:select id from information_schema.processlist where id != connection_id() and 40314 in (0, id) and state like concat(‘%’, ‘metadata lock’, ‘%’) and info  like concat(‘%’, ‘rename’, ‘%’)</li>
<li>T5-40314:rename table employee1 to _employee1_del, _employee1_gho to employee1</li>
<li>T6-40318:select id from information_schema.processlist where id != connection_id() and 40314 in (0, id) and state like concat(‘%’, ‘metadata lock’, ‘%’) and info  like concat(‘%’, ‘rename’, ‘%’)</li>
<li>T7-40318:select is_used_lock(‘gh-ost.40312.lock’)</li>
<li>T8-40312:drop table if exists _employee1_del</li>
<li>T9-40312:unlock tables</li>
<li>T10-40314:drop table if exists _employee1_ghc</li>
<li>T11-40317:drop table if exists _employee1_del</li>
</ul>
<h3 id="日志解析"><a href="#日志解析" class="headerlink" title="日志解析"></a>日志解析</h3><ul>
<li>T1 创建临时表_employee1_del，防止提前rename表，导致数据丢失。(如果创建失败，则gh-ost程序退出，此时创建语句并非create table if exists)</li>
<li>T2 原表，影子表加写锁，此时原表的DML会阻塞。(如果加锁失败，则gh-ost程序退出)</li>
<li>T3 获取实例状态，确定是否进行下一步。(查询状态,不影响上下文)</li>
<li>T4 查看当前是否有进程有rename在运行，查询不到的话，可以进行rename操作。(如果查询到rename，下文确定是否获取T2时刻的锁)</li>
<li>T5 进行rename交换表，由于在T2时刻表上有写锁，rename会阻塞。(如果此时T2意外中止，rename会退出，因为临时表_employee1_del已经存在)</li>
<li>T6 再次查询是否有进程有rename在运行。(如果gh-ost捕捉不到rename，则T2会继续进行下一步T9，所有请求恢复正常)</li>
<li>T7 查询到rename操作，确定T2的上锁生效。(如果T2,T5全部失败,T2会释放锁,T5会被清除)</li>
<li>T8 删除临时表_employee1_del。(由于T2对_employee1_del加锁,在未unlock tables前,同一session是可以drop操作的。如果drop失败，rename也会失败，因为表对_employee1_del已存在，会继续T9，所有请求恢复正常)</li>
<li>T9 释放unlock tables</li>
<li>T10-T11 释放其他临时表</li>
</ul>
<h3 id="官方参考"><a href="#官方参考" class="headerlink" title="官方参考"></a>官方参考</h3><p>作者写了三篇文章解释cut-over操作的思路和切换算法，<a href="http://code.openark.org/blog/mysql/solving-the-facebook-osc-non-atomic-table-swap-problem" target="_blank" rel="noopener">链接1</a>，<a href="http://code.openark.org/blog/mysql/solving-the-non-atomic-table-swap-take-ii" target="_blank" rel="noopener">链接2</a>，<a href="http://code.openark.org/blog/mysql/solving-the-non-atomic-table-swap-take-iii-making-it-atomic" target="_blank" rel="noopener">链接3</a>，可参考，这里仅列出官方示例说明:<br></p>
<p>The solution we offer is now based on two connections only (as opposed to three, in the optimistic approach). “Our” connections will be C10, C20. The “normal” app connections are C1..C9, C11..C19, C21..C29.<br></p>
<ul>
<li>Connections C1..C9 operate on tbl with normal DML: INSERT, UPDATE, DELETE</li>
<li>Connection C10: CREATE TABLE tbl_old (id int primary key) COMMENT=’magic-be-here’</li>
<li>Connection C10: LOCK TABLES tbl WRITE, tbl_old WRITE</li>
<li>Connections C11..C19, newly incoming, issue queries on tbl but are blocked due to the LOCK</li>
<li>Connection C20: RENAME TABLE tbl TO tbl_old, ghost TO tbl. This is blocked due to the LOCK, but gets prioritized on top connections C11..C19 and on top C1..C9 or any other connection that attempts DML on tbl</li>
<li>Connections C21..C29, newly incoming, issue queries on tbl but are blocked due to the LOCK and due to the RENAME, waiting in queue</li>
<li>Connection C10: checks that C20’s RENAME is applied (looks for the blocked RENAME in processlist)</li>
<li>Connection 10: DROP TABLE tbl_old. Nothing happens yet; tbl is still locked. All other connections still blocked.</li>
<li>Connection 10: UNLOCK TABLES. BAM! The RENAME is first to execute, ghost table is swapped in place of tbl, then C1..C9, C11..C19, C21..C29 all get to operate on the new and shiny tbl</li>
</ul>
<p>Some notes<br></p>
<ul>
<li>We create tbl_old as a blocker for a premature swap</li>
<li>It is allowed for a connection to DROP a table it has under a WRITE LOCK</li>
<li>A blocked RENAME is always prioritized over a blocked INSERT/UPDATE/DELETE, no matter who came first</li>
</ul>
<p>What happens on failures?<br><br>Much fun. Just works; no rollback required.<br></p>
<ul>
<li>If C10 errors on the CREATE we do not proceed.</li>
<li>If C10 errors on the LOCK statement, we do not proceed. The table is not locked. App continues to operate as normal.</li>
<li><p>If C10 dies just as C20 is about to issue the RENAME:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The lock <span class="keyword">is</span> released, <span class="keyword">the</span> queries C1..C9, C11..C19 immediately operate <span class="keyword">on</span> tbl.</span><br><span class="line">C20’s RENAME immediately fails because tbl_old exists.</span><br><span class="line">The entire operation <span class="keyword">is</span> failed, <span class="keyword">but</span> nothing terrible happens; <span class="keyword">some</span> queries were blocked <span class="keyword">for</span> <span class="keyword">some</span> <span class="built_in">time</span> <span class="keyword">is</span> all. We will need <span class="keyword">to</span> retry everything</span><br></pre></td></tr></table></figure>
</li>
<li><p>If C10 dies while C20 is blocked on RENAME: Mostly similar to the above. Lock released, then C20 fails the RENAME (because tbl_old exists), then all queries resume normal operation</p>
</li>
<li>If C20 dies before C10 drops the table, we catch the error and let C10 proceed as planned: DROP, UNLOCK. Nothing terrible happens, some queries were blocked for some time. We will need to retry</li>
<li>If C20 dies just after C10 DROPs the table but before the unlock, same as above.</li>
<li>If both C10 and C20 die, no problem: LOCK is cleared; RENAME lock is cleared. C1..C9, C11..C19, C21..C29 are free to operate on tbl.</li>
</ul>
<p>No matter what happens, at the end of operation we look for the ghost table. Is it still there? Then we know the operation failed, “atomically”. Is it not there? Then it has been renamed to tbl, and the operation worked atomically.</p>
<p>A side note on failure is the matter of cleaning up the magic tbl_old. Here this is a matter of taste. Maybe just let it live and avoid recreating it, or you can drop it if you like.</p>
<h3 id="对应用的影响"><a href="#对应用的影响" class="headerlink" title="对应用的影响"></a>对应用的影响</h3><p>应用程序连接保证被阻止，直到交换 ghost 表或直到操作失败。在前者中，他们继续在新表上进行操作。在后者中，他们继续在原表上进行操作。</p>
<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><p>以gh-ost 1.0.48版本为准<br></p>
<table>
<thead>
<tr>
<th><div style="width:50px">参数</div></th>
<th><div style="width:800px">描述</div></th>
</tr>
</thead>
<tbody>
<tr>
<td>-aliyun-rds</td>
<td>set ‘true’,允许在阿里云数据库上执行</td>
</tr>
<tr>
<td>-allow-master-master</td>
<td>是否允许gh-ost运行在双主复制架构中，一般与-assume-master-host参数一起使用</td>
</tr>
<tr>
<td>-allow-nullable-unique-key</td>
<td>允许gh-ost在数据迁移依赖的唯一键可以为NULL，默认为不允许为NULL的唯一键。如果数据迁移(migrate)依赖的唯一键允许NULL值，则可能造成数据不正确，请谨慎使用。</td>
</tr>
<tr>
<td>-allow-on-master</td>
<td>允许gh-ost直接运行在主库上，默认gh-ost连接的从库。</td>
</tr>
<tr>
<td>-alter string</td>
<td>string:DDL语句</td>
</tr>
<tr>
<td>-approve-renamed-columns</td>
<td>ALTER:如果你修改一个列的名字，gh-ost将会识别到并且需要提供重命名列名的原因，默认情况下gh-ost是不继续执行的，除非提供-approve-renamed-columns ALTER。</td>
</tr>
<tr>
<td>-ask-pass</td>
<td>MySQL密码</td>
</tr>
<tr>
<td>-assume-master-host</td>
<td>string:为gh-ost指定一个主库，格式为”ip:port”或者”hostname:port”。在这主主架构里比较有用，或则在gh-ost发现不到主的时候有用。</td>
</tr>
<tr>
<td>-assume-rbr</td>
<td>确认gh-ost连接的数据库实例的binlog_format=ROW的情况下，可以指定-assume-rbr，这样可以禁止从库上运行stop slave,start slave,执行gh-ost用户也不需要SUPER权限。</td>
</tr>
<tr>
<td>-check-flag</td>
<td>检查是否存在/支持另一个标志。 这允许跨版本脚本编写。 当所有其他提供的标志都存在时，以0退出，否则返回非零。 您必须为需要值的标志提供（虚拟）值。 示例：gh-ost –check-flag –cut-over-lock-timeout-seconds –nice-ratio 0</td>
</tr>
<tr>
<td>-chunk-size</td>
<td>int:在每次迭代中处理的行数量(允许范围：100-100000)，默认值为1000。</td>
</tr>
<tr>
<td>-concurrent-rowcount</td>
<td>该参数如果为True(默认值)，则进行row-copy之后，估算统计行数(使用explain select count(*)方式)，并调整ETA时间，否则，gh-ost首先预估统计行数，然后开始row-copy。</td>
</tr>
<tr>
<td>-conf</td>
<td>gh-ost的配置文件路径。</td>
</tr>
<tr>
<td>-critical-load</td>
<td>string:一系列逗号分隔的status-name=values组成，当MySQL中status超过对应的values，gh-ost将会退出。-critical-load Threads_connected=20,Connections=1500，指的是当MySQL中的状态值Threads_connected&gt;20,Connections&gt;1500的时候，gh-ost将会由于该数据库严重负载而停止并退出。</td>
</tr>
<tr>
<td>-critical-load-hibernate-seconds</td>
<td>int:负载达到critical-load时，gh-ost在指定的时间内进入休眠状态。 它不会读/写任何来自任何服务器的任何内容。</td>
</tr>
<tr>
<td>-critical-load-interval-millis</td>
<td>int:当值为0时，当达到-critical-load，gh-ost立即退出。当值不为0时，当达到-critical-load，gh-ost会在-critical-load-interval-millis秒数后，再次进行检查，再次检查依旧达到-critical-load，gh-ost将会退出。</td>
</tr>
<tr>
<td>-cut-over</td>
<td>string:选择cut-over类型:atomic/two-step，atomic(默认)类型的cut-over是github的算法，two-step采用的是facebook-OSC的算法。</td>
</tr>
<tr>
<td>-cut-over-exponential-backoff</td>
<td>两次失败的切换尝试之间的等待时间间隔成指数增长。 等待间隔服从”exponential-backoff-max-interval”可配置的最大值。</td>
</tr>
<tr>
<td>-cut-over-lock-timeout-seconds</td>
<td>int:gh-ost在cut-over阶段最大的锁等待时间，当锁超时时，gh-ost的cut-over将重试。(默认值：3)</td>
</tr>
<tr>
<td>-database</td>
<td>string:数据库名称。</td>
</tr>
<tr>
<td>-debug</td>
<td>debug模式。</td>
</tr>
<tr>
<td>-default-retries</td>
<td>int:各种操作在panick前重试次数。(默认为60)</td>
</tr>
<tr>
<td>-discard-foreign-keys</td>
<td>该参数针对一个有外键的表，在gh-ost创建ghost表时，并不会为ghost表创建外键。该参数很适合用于删除外键，除此之外，请谨慎使用。</td>
</tr>
<tr>
<td>-dml-batch-size</td>
<td>int:在单个事务中应用DML事件的批量大小（范围1-100）（默认值为10）</td>
</tr>
<tr>
<td>-exact-rowcount</td>
<td>准确统计表行数(使用select count(*)的方式)，得到更准确的预估时间。</td>
</tr>
<tr>
<td>-execute</td>
<td>实际执行alter&amp;migrate表，默认为noop，不执行，仅仅做测试并退出，如果想要ALTER TABLE语句真正落实到数据库中去，需要明确指定-execute</td>
</tr>
<tr>
<td>-exponential-backoff-max-interval</td>
<td>在执行具有指数补偿的各种操作时，两次尝试之间等待的最大秒数。 （默认为64）</td>
</tr>
<tr>
<td>-force-named-cut-over</td>
<td>如果为true，则’unpostpone cut-over’交互式命令必须命名迁移的表</td>
</tr>
<tr>
<td>-force-table-names</td>
<td>string:在临时表上使用的表名前缀</td>
</tr>
<tr>
<td>-gcp</td>
<td>在第一代Google Cloud Platform（GCP）上执行时，请将其设置为”true”。</td>
</tr>
<tr>
<td>-heartbeat-interval-millis</td>
<td>gh-ost心跳频率值，默认为500</td>
</tr>
<tr>
<td>-help</td>
<td>帮助</td>
</tr>
<tr>
<td>-hooks-hint</td>
<td>string:任意消息通过GH_OST_HOOKS_HINT注入到钩子</td>
</tr>
<tr>
<td>-hooks-hint-owner</td>
<td>通过GH_OST_HOOKS_HINT_OWNER将所有者的任意名称注入到钩子中</td>
</tr>
<tr>
<td>-hooks-hint-token</td>
<td>通过GH_OST_HOOKS_HINT_TOKEN将任意令牌注入到挂钩中</td>
</tr>
<tr>
<td>-hooks-path</td>
<td>string:hook文件存放目录(默认为empty，即禁用hook)。hook会在这个目录下寻找符合约定命名的hook文件来执行。</td>
</tr>
<tr>
<td>-host</td>
<td>string :MySQL IP/hostname</td>
</tr>
<tr>
<td>-initially-drop-ghost-table</td>
<td>gh-ost操作之前，检查并删除已经存在的ghost表。该参数不建议使用，请手动处理原来存在的ghost表。默认不启用该参数，gh-ost直接退出操作。</td>
</tr>
<tr>
<td>-initially-drop-old-table</td>
<td>gh-ost操作之前，检查并删除已经存在的旧表。该参数不建议使用，请手动处理原来存在的ghost表。默认不启用该参数，gh-ost直接退出操作。</td>
</tr>
<tr>
<td>-initially-drop-socket-file</td>
<td>gh-ost强制删除已经存在的socket文件。该参数不建议使用，可能会删除一个正在运行的gh-ost程序，导致DDL失败。</td>
</tr>
<tr>
<td>-master-password</td>
<td>string:MySQL主密码</td>
</tr>
<tr>
<td>-master-user</td>
<td>string:MysQL主账号</td>
</tr>
<tr>
<td>-max-lag-millis</td>
<td>主从复制最大延迟时间，当主从复制延迟时间超过该值后，gh-ost将采取节流(throttle)措施，默认值：1500s。</td>
</tr>
<tr>
<td>-max-load</td>
<td>string:逗号分隔状态名称=阈值，如：’Threads_running=100,Threads_connected=500’. When status exceeds threshold, app throttles writes</td>
</tr>
<tr>
<td>-migrate-on-replica</td>
<td>gh-ost的数据迁移(migrate)运行在从库上，而不是主库上。 </td>
</tr>
<tr>
<td>-nice-ratio</td>
<td>float:每次chunk时间段的休眠时间，范围[0.0…100.0]。0：每个chunk时间段不休眠，即一个chunk接着一个chunk执行；1：每row-copy 1毫秒，则另外休眠1毫秒；0.7：每row-copy 10毫秒，则另外休眠7毫秒。</td>
</tr>
<tr>
<td>-ok-to-drop-table</td>
<td>gh-ost操作结束后，删除旧表，默认状态是不删除旧表，会存在_tablename_del表。</td>
</tr>
<tr>
<td>-panic-flag-file</td>
<td>string:当这个文件被创建，gh-ost将会立即退出。</td>
</tr>
<tr>
<td>-password</td>
<td>string:MySQL密码</td>
</tr>
<tr>
<td>-port</td>
<td>int:MySQL端口</td>
</tr>
<tr>
<td>-postpone-cut-over-flag-file</td>
<td>string：当这个文件存在的时候，gh-ost的cut-over阶段将会被推迟，数据仍然在复制，直到该文件被删除。</td>
</tr>
<tr>
<td>-quiet</td>
<td>静默模式</td>
</tr>
<tr>
<td>-replica-server-id</td>
<td>uint:gh-ost的server_id</td>
</tr>
<tr>
<td>-replication-lag-query</td>
<td>string:弃用</td>
</tr>
<tr>
<td>-serve-socket-file</td>
<td>string：gh-ost的socket文件绝对路径。</td>
</tr>
<tr>
<td>-serve-tcp-port</td>
<td>int:gh-ost使用端口，默认为关闭端口。</td>
</tr>
<tr>
<td>-skip-foreign-key-checks</td>
<td>确定你的表上没有外键时，设置为’true’，并且希望跳过gh-ost验证的时间-skip-renamed-columns ALTER</td>
</tr>
<tr>
<td>-skip-renamed-columns</td>
<td>ALTER：如果你修改一个列的名字(如change column)，gh-ost将会识别到并且需要提供重命名列名的原因，默认情况下gh-ost是不继续执行的。该参数告诉gh-ost跳该列的数据迁移，让gh-ost把重命名列作为无关紧要的列。该操作很危险，你会损失该列的所有值。</td>
</tr>
<tr>
<td>-ssl</td>
<td>ssl连接MySQL</td>
</tr>
<tr>
<td>-ssl-allow-insecure</td>
<td>Skips verification of MySQL hosts’ certificate chain and host name. Requires –ssl</td>
</tr>
<tr>
<td>-ssl-ca</td>
<td>CA certificate in PEM format for TLS connections to MySQL hosts. Requires –ssl</td>
</tr>
<tr>
<td>-stack</td>
<td>添加错误堆栈追踪。</td>
</tr>
<tr>
<td>-switch-to-rbr</td>
<td>让gh-ost自动将从库的binlog_format转换为ROW格式。</td>
</tr>
<tr>
<td>-table</td>
<td>string:表名</td>
</tr>
<tr>
<td>-test-on-replica</td>
<td>在从库上测试gh-ost，包括在从库上数据迁移(migration)，数据迁移完成后stop slave，原表和ghost表立刻交换而后立刻交换回来。继续保持stop slave，使你可以对比两张表。</td>
</tr>
<tr>
<td>-test-on-replica-skip-replica-stop</td>
<td>当-test-on-replica执行时，该参数表示该过程中不用stop slave。</td>
</tr>
<tr>
<td>-throttle-additional-flag-file</td>
<td>string:当该文件被创建后，gh-ost操作立即停止。该参数可以用在多个gh-ost同时操作的时候，创建一个文件，让所有的gh-ost操作停止，或者删除这个文件，让所有的gh-ost操作恢复。</td>
</tr>
<tr>
<td>-throttle-control-replicas</td>
<td>string:列出所有需要被检查主从复制延迟的从库。</td>
</tr>
<tr>
<td>-throttle-flag-file</td>
<td>string:当该文件被创建后，gh-ost操作立即停止。该参数适合控制单个gh-ost操作。-throttle-additional-flag-file string适合控制多个gh-ost操作。</td>
</tr>
<tr>
<td>-throttle-http</td>
<td>when given, gh-ost checks given URL via HEAD request; any response code other than 200 (OK) causes throttling; make sure it has low latency response  -throttle-query string</td>
</tr>
<tr>
<td>-throttle-query</td>
<td>string:节流查询。每秒钟执行一次。当返回值=0时不需要节流，当返回值&gt;0时，需要执行节流操作。该查询会在数据迁移(migrated)服务器上操作，所以请确保该查询是轻量级的。</td>
</tr>
<tr>
<td>-timestamp-old-table</td>
<td>在旧表名中使用时间戳。 这会使旧表名称具有唯一且无冲突的交叉迁移</td>
</tr>
<tr>
<td>-tungsten</td>
<td>告诉gh-ost你正在运行的是一个tungsten-replication拓扑结构。</td>
</tr>
<tr>
<td>-user</td>
<td>string:MYSQL用户</td>
</tr>
<tr>
<td>-verbose</td>
<td>verbose</td>
</tr>
<tr>
<td>-version</td>
<td>版本</td>
</tr>
</tbody>
</table>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h3 id="单实例DDL"><a href="#单实例DDL" class="headerlink" title="单实例DDL"></a>单实例DDL</h3><p>相当于主库，需要开启–allow-on-master参数和ROW模式<br><br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">./gh-ost \</span><br><span class="line">-<span class="ruby">-max-load=Threads_running=<span class="number">25</span> \</span></span><br><span class="line"><span class="ruby">--critical-load=Threads_running=<span class="number">512</span> \</span></span><br><span class="line"><span class="ruby">--chunk-size=<span class="number">1000</span> \</span></span><br><span class="line"><span class="ruby">--initially-drop-old-table \</span></span><br><span class="line"><span class="ruby">--initially-drop-ghost-table \</span></span><br><span class="line"><span class="ruby">--initially-drop-socket-file \</span></span><br><span class="line"><span class="ruby">--ok-to-drop-table \</span></span><br><span class="line"><span class="ruby">--conf=<span class="string">"/etc/my.cnf"</span> \</span></span><br><span class="line"><span class="ruby">--host=<span class="string">"master:ip"</span> \</span></span><br><span class="line"><span class="ruby">--port=<span class="number">3306</span> \</span></span><br><span class="line"><span class="ruby">--user=<span class="string">"root"</span> \</span></span><br><span class="line"><span class="ruby">--password=<span class="string">"xxx"</span> \</span></span><br><span class="line"><span class="ruby">--database=<span class="string">"sysbench"</span> \</span></span><br><span class="line"><span class="ruby">--table=<span class="string">"sbtest1"</span> \</span></span><br><span class="line"><span class="ruby">--verbose \</span></span><br><span class="line"><span class="ruby">--alter=<span class="string">"engine=innodb"</span> \</span></span><br><span class="line"><span class="ruby">--switch-to-rbr \</span></span><br><span class="line"><span class="ruby">--allow-on-master \</span></span><br><span class="line"><span class="ruby">--allow-master-master \</span></span><br><span class="line"><span class="ruby">--cut-over=default \</span></span><br><span class="line"><span class="ruby">--default-retries=<span class="number">120</span> \</span></span><br><span class="line"><span class="ruby">--panic-flag-file=<span class="regexp">/tmp/ghost</span>.panic.flag \</span></span><br><span class="line"><span class="ruby">--serve-socket-file=<span class="regexp">/tmp/gh</span>-ost.socket.sock  \</span></span><br><span class="line"><span class="ruby">--execute</span></span><br></pre></td></tr></table></figure></p>
<h3 id="主从上DDL"><a href="#主从上DDL" class="headerlink" title="主从上DDL"></a>主从上DDL</h3><p>有2个选择，一是按照单实例DDL直接在主上执行同步到从上，另一个连接到从库，在主库做迁移（只要保证从库的binlog为ROW即可，主库不需要保证）,以下去除了参数–allow-on-master<br><br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">./gh-ost \</span><br><span class="line">-<span class="ruby">-max-load=Threads_running=<span class="number">25</span> \</span></span><br><span class="line"><span class="ruby">--critical-load=Threads_running=<span class="number">512</span> \</span></span><br><span class="line"><span class="ruby">--chunk-size=<span class="number">1000</span> \</span></span><br><span class="line"><span class="ruby">--initially-drop-old-table \</span></span><br><span class="line"><span class="ruby">--initially-drop-ghost-table \</span></span><br><span class="line"><span class="ruby">--initially-drop-socket-file \</span></span><br><span class="line"><span class="ruby">--ok-to-drop-table \</span></span><br><span class="line"><span class="ruby">--conf=<span class="string">"/etc/my.cnf"</span> \</span></span><br><span class="line"><span class="ruby">--host=<span class="string">"slave:ip"</span> \</span></span><br><span class="line"><span class="ruby">--port=<span class="number">3306</span> \</span></span><br><span class="line"><span class="ruby">--user=<span class="string">"root"</span> \</span></span><br><span class="line"><span class="ruby">--password=<span class="string">"xxx"</span> \</span></span><br><span class="line"><span class="ruby">--database=<span class="string">"sysbench"</span> \</span></span><br><span class="line"><span class="ruby">--table=<span class="string">"sbtest1"</span> \</span></span><br><span class="line"><span class="ruby">--verbose \</span></span><br><span class="line"><span class="ruby">--alter=<span class="string">"engine=innodb"</span> \</span></span><br><span class="line"><span class="ruby">--switch-to-rbr \</span></span><br><span class="line"><span class="ruby">--allow-master-master \</span></span><br><span class="line"><span class="ruby">--cut-over=default \</span></span><br><span class="line"><span class="ruby">--default-retries=<span class="number">120</span> \</span></span><br><span class="line"><span class="ruby">--panic-flag-file=<span class="regexp">/tmp/ghost</span>.panic.flag \</span></span><br><span class="line"><span class="ruby">--serve-socket-file=<span class="regexp">/tmp/gh</span>-ost.socket.sock  \</span></span><br><span class="line"><span class="ruby">--execute</span></span><br></pre></td></tr></table></figure></p>
<p>注意：<br></p>
<ul>
<li>在执行DDL中，从库会执行一次stop/start slave，要是确定从的binlog是ROW的话可以添加参数：–assume-rbr。如果从库的binlog不是ROW，可以用参数–switch-to-rbr来转换成ROW，此时需要注意的是执行完毕之后，binlog模式不会被转换成原来的值。–assume-rbr和–switch-to-rbr参数不能一起使用。</li>
<li>–host需要连接从库的ip</li>
</ul>
<h3 id="非分区表改为分区表"><a href="#非分区表改为分区表" class="headerlink" title="非分区表改为分区表"></a>非分区表改为分区表</h3><p>1.将原表的id自增改为非自增，使用mysql online ddl，不锁表的方式<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> employee1 <span class="keyword">modify</span> <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,algorithm=inplace,<span class="keyword">lock</span>=<span class="keyword">none</span>;</span><br></pre></td></tr></table></figure></p>
<p>2.删除分区字段内的空值，省略</p>
<p>3.删除原主键，添加联合主键<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> employee1 <span class="keyword">drop</span> primary <span class="keyword">key</span>,<span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span> (create_time,<span class="keyword">id</span>),algorithm=inplace,<span class="keyword">lock</span>=<span class="keyword">none</span>;</span><br></pre></td></tr></table></figure></p>
<p>4.gh-ost重建分区<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">./gh-ost \</span><br><span class="line">-<span class="ruby">-max-load=Threads_running=<span class="number">25</span> \</span></span><br><span class="line"><span class="ruby">--critical-load=Threads_running=<span class="number">512</span> \</span></span><br><span class="line"><span class="ruby">--chunk-size=<span class="number">1000</span> \</span></span><br><span class="line"><span class="ruby">--initially-drop-old-table \</span></span><br><span class="line"><span class="ruby">--initially-drop-ghost-table \</span></span><br><span class="line"><span class="ruby">--initially-drop-socket-file \</span></span><br><span class="line"><span class="ruby">--ok-to-drop-table \</span></span><br><span class="line"><span class="ruby">--conf=<span class="string">"/etc/my.cnf"</span> \</span></span><br><span class="line"><span class="ruby">--host=<span class="string">"localhost"</span> \</span></span><br><span class="line"><span class="ruby">--port=<span class="number">3306</span> \</span></span><br><span class="line"><span class="ruby">--user=<span class="string">"root"</span> \</span></span><br><span class="line"><span class="ruby">--password=<span class="string">"n9dW2TvsOI"</span> \</span></span><br><span class="line"><span class="ruby">--database=<span class="string">"sysbench"</span> \</span></span><br><span class="line"><span class="ruby">--table=<span class="string">"employee1"</span> \</span></span><br><span class="line"><span class="ruby">--verbose \</span></span><br><span class="line"><span class="ruby">--alter=<span class="string">" partition by RANGE COLUMNS (create_time)(PARTITION P202003 VALUES LESS THAN ('2020-04-01'),PARTITION P202004 VALUES LESS THAN ('2020-05-01'),PARTITION P202005 VALUES LESS THAN ('2020-06-01'), PARTITION PMAX VALUES LESS THAN  MAXVALUE  ) "</span> \</span></span><br><span class="line"><span class="ruby">--switch-to-rbr \</span></span><br><span class="line"><span class="ruby">--allow-on-master \</span></span><br><span class="line"><span class="ruby">--allow-master-master \</span></span><br><span class="line"><span class="ruby">--cut-over=default \</span></span><br><span class="line"><span class="ruby">--default-retries=<span class="number">120</span> \</span></span><br><span class="line"><span class="ruby">--panic-flag-file=<span class="regexp">/tmp/ghost</span>.panic.flag \</span></span><br><span class="line"><span class="ruby">--serve-socket-file=<span class="regexp">/tmp/gh</span>-ost.socket.sock  \</span></span><br><span class="line"><span class="ruby">--execute</span></span><br></pre></td></tr></table></figure></p>
<h3 id="终止、暂停、限速"><a href="#终止、暂停、限速" class="headerlink" title="终止、暂停、限速"></a>终止、暂停、限速</h3><ul>
<li>① 表示文件终止运行：–panic-flag-file。</li>
<li>创建文件终止运行，例子中创建/tmp/ghost.panic.flag文件，终止正在运行的gh-ost，临时文件清理需要手动进行。</li>
<li>② 表示文件禁止cut-over进行，即禁止表名切换，数据复制正常进行。–postpone-cut-over-flag-file</li>
<li>创建文件延迟cut-over进行，即推迟切换操作。例子中创建/tmp/ghost.postpone.flag文件，gh-ost 会完成行复制，但并不会切换表，它会持续的将原表的数据更新操作同步到临时表中。(适用于夜里变更时间较长,担心自动cut-over失败,延迟cut-over,早上上班后再做切换)</li>
<li>③ 使用socket监听请求，操作者可以在命令运行后更改相应的参数。–serve-socket-file，–serve-tcp-port（默认关闭）</li>
<li>创建socket文件进行监听，通过接口进行参数调整，当执行操作的过程中发现负载、延迟上升了，不得不终止操作，重新配置参数，如 chunk-size，然后重新执行操作命令，可以通过scoket接口进行动态调整。如：<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">暂停操作：</span><br><span class="line"><span class="comment">#暂停</span></span><br><span class="line"><span class="keyword">echo</span> throttle | socat - <span class="string">/tmp/gh-ost.socket.sock</span></span><br><span class="line"><span class="comment">#恢复</span></span><br><span class="line"><span class="keyword">echo</span> no-throttle | socat - <span class="string">/tmp/gh-ost.socket.sock</span></span><br><span class="line"></span><br><span class="line">修改限速参数：</span><br><span class="line"><span class="keyword">echo</span> chunk-size=100 | socat - <span class="string">/tmp/gh-ost.socket.sock</span></span><br><span class="line"><span class="keyword">echo</span> max-lag-millis=200 | socat - <span class="string">/tmp/gh-ost.socket.sock</span></span><br><span class="line"><span class="keyword">echo</span> max-load=Thread_running=3 | socat - <span class="string">/tmp/gh-ost.socket.sock</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注意：<br><br><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--postpone-<span class="built_in">cut</span>-<span class="built_in">over</span>-flag-file=/tmp/ghost.postpone.flag  #如果指定该参数，此文件执行时就会创建，默认也就延迟做<span class="built_in">cut</span>-<span class="built_in">over</span>，直到文件删除，执行<span class="built_in">cut</span>-<span class="built_in">over</span></span><br></pre></td></tr></table></figure></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>gh-ost问世之后，由于其创建的设计模式，对生产的影响较小，已经成为了DDL的标准工具，广泛应用于生产。特别是公司内部有自建的运维平台，gh-ost多数会集成进平台，成为标配工具。即使在MySQL 8.0.12后官方的MySQL Online DDL支持秒级加字段，加索引，但是因为其限制，仅支持部分的场景可以做到秒级。并且，多数公司使用的MySQL版本还停留在5.7版本，目前来看，gh-ost是最优秀的MySQL DDL工具。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://segmentfault.com/a/1190000006158503" target="_blank" rel="noopener">https://segmentfault.com/a/1190000006158503</a><br><a href="https://segmentfault.com/a/1190000020409138" target="_blank" rel="noopener">https://segmentfault.com/a/1190000020409138</a><br><a href="https://segmentfault.com/a/1190000020417715" target="_blank" rel="noopener">https://segmentfault.com/a/1190000020417715</a></p>

      
    </div>
    
    
    

    

    

    
<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

  
</div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/github/" rel="tag"># github</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/pt-online-schema-change-使用教程.html" rel="next" title="pt-online-schema-change 使用教程">
                <i class="fa fa-chevron-left"></i> pt-online-schema-change 使用教程
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/jiessie.png"
                alt="Jiessie" />
            
              <p class="site-author-name" itemprop="name">Jiessie</p>
              <p class="site-description motion-element" itemprop="description">最怕一生碌碌无为,还说平凡难能可贵！</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://www.percona.com/" target="_blank" title="Percona">
                      
                        <i class="fa fa-fw fa-globe"></i>Percona</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://mariadb.com/kb/zh-cn/mariadb/" target="_blank" title="MariaDB">
                      
                        <i class="fa fa-fw fa-globe"></i>MariaDB</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://mysqlserverteam.com/" target="_blank" title="serverteam">
                      
                        <i class="fa fa-fw fa-globe"></i>serverteam</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://mysqlhighavailability.com/" target="_blank" title="highavailability">
                      
                        <i class="fa fa-fw fa-globe"></i>highavailability</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://mysql.taobao.org/monthly/" target="_blank" title="淘宝月报">
                      
                        <i class="fa fa-fw fa-globe"></i>淘宝月报</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://dimitrik.free.fr/blog/" target="_blank" title="dimitrik">
                      
                        <i class="fa fa-fw fa-globe"></i>dimitrik</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#引言"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原理"><span class="nav-number">2.</span> <span class="nav-text">原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#gh-ost-介绍"><span class="nav-number">2.1.</span> <span class="nav-text">gh-ost 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#general-log"><span class="nav-number">2.2.</span> <span class="nav-text">general_log</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行过程解析"><span class="nav-number">2.3.</span> <span class="nav-text">执行过程解析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#检查"><span class="nav-number">2.3.1.</span> <span class="nav-text">检查</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#伪装slave"><span class="nav-number">2.3.2.</span> <span class="nav-text">伪装slave</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建日志记录表-xx-ghc-和影子表-xx-gho-并且执行-alter-语句将影子表变更为目标表结构"><span class="nav-number">2.3.3.</span> <span class="nav-text">创建日志记录表 xx_ghc 和影子表 xx_gho 并且执行 alter 语句将影子表变更为目标表结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#insert-into-xx-gho-select-from-xx-拷贝数据"><span class="nav-number">2.3.4.</span> <span class="nav-text">insert into xx_gho select * from xx 拷贝数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#应用增量数据"><span class="nav-number">2.3.5.</span> <span class="nav-text">应用增量数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建xx-del表"><span class="nav-number">2.3.6.</span> <span class="nav-text">创建xx_del表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#执行过程总结"><span class="nav-number">2.4.</span> <span class="nav-text">执行过程总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gh-ost-操作模式"><span class="nav-number">3.</span> <span class="nav-text">gh-ost 操作模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#连接到从库，在主库做迁移"><span class="nav-number">3.1.</span> <span class="nav-text">连接到从库，在主库做迁移</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#连接到主库"><span class="nav-number">3.2.</span> <span class="nav-text">连接到主库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在从库迁移-测试"><span class="nav-number">3.3.</span> <span class="nav-text">在从库迁移/测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#时序问题"><span class="nav-number">4.</span> <span class="nav-text">时序问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cut-over原理"><span class="nav-number">5.</span> <span class="nav-text">cut-over原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#general-log-1"><span class="nav-number">5.1.</span> <span class="nav-text">general_log</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日志说明"><span class="nav-number">5.2.</span> <span class="nav-text">日志说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日志解析"><span class="nav-number">5.3.</span> <span class="nav-text">日志解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#官方参考"><span class="nav-number">5.4.</span> <span class="nav-text">官方参考</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对应用的影响"><span class="nav-number">5.5.</span> <span class="nav-text">对应用的影响</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参数"><span class="nav-number">6.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#案例"><span class="nav-number">7.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单实例DDL"><span class="nav-number">7.1.</span> <span class="nav-text">单实例DDL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#主从上DDL"><span class="nav-number">7.2.</span> <span class="nav-text">主从上DDL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#非分区表改为分区表"><span class="nav-number">7.3.</span> <span class="nav-text">非分区表改为分区表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#终止、暂停、限速"><span class="nav-number">7.4.</span> <span class="nav-text">终止、暂停、限速</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">8.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">9.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jiessie</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  


<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

</body>
</html>
