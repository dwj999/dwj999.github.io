<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="percona,innodb,recovery," />





  <link rel="alternate" href="/atom.xml" title="Jiessie's' Blog" type="application/atom+xml" />






<meta name="description" content="前言数据是一个企业最重要的资产，备份的重要性不言而喻，有效的备份能够减少意外情况下的公司损失。当使用MySQL数据库时，mysqldump、mysqlpump、mydumper、xtrabackup等都是不错的备份工具，极端情况下，当开启了binlog，也可以成为恢复的救命稻草。但是，还有存在无备份，没有开启binlog的情况，如果是InnoDB表，这时percona推出的Percona Data">
<meta name="keywords" content="percona,innodb,recovery">
<meta property="og:type" content="article">
<meta property="og:title" content="使用Percona Data Recovery Tool for InnoDB恢复数据">
<meta property="og:url" content="https://dwj999.github.io/使用Percona-Data-Recovery-Tool-for-InnoDB恢复数据.html">
<meta property="og:site_name" content="Jiessie&#39;s&#39; Blog">
<meta property="og:description" content="前言数据是一个企业最重要的资产，备份的重要性不言而喻，有效的备份能够减少意外情况下的公司损失。当使用MySQL数据库时，mysqldump、mysqlpump、mydumper、xtrabackup等都是不错的备份工具，极端情况下，当开启了binlog，也可以成为恢复的救命稻草。但是，还有存在无备份，没有开启binlog的情况，如果是InnoDB表，这时percona推出的Percona Data">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-05-20T07:31:16.561Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用Percona Data Recovery Tool for InnoDB恢复数据">
<meta name="twitter:description" content="前言数据是一个企业最重要的资产，备份的重要性不言而喻，有效的备份能够减少意外情况下的公司损失。当使用MySQL数据库时，mysqldump、mysqlpump、mydumper、xtrabackup等都是不错的备份工具，极端情况下，当开启了binlog，也可以成为恢复的救命稻草。但是，还有存在无备份，没有开启binlog的情况，如果是InnoDB表，这时percona推出的Percona Data">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://dwj999.github.io/使用Percona-Data-Recovery-Tool-for-InnoDB恢复数据.html"/>





<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>

  <title>使用Percona Data Recovery Tool for InnoDB恢复数据 | Jiessie's' Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
<a href="https://github.com/dwj999"><img width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jiessie's' Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">没伞的孩子必须努力奔跑</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dwj999.github.io/使用Percona-Data-Recovery-Tool-for-InnoDB恢复数据.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiessie">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/jiessie.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jiessie's' Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">使用Percona Data Recovery Tool for InnoDB恢复数据</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-14T14:28:11+08:00">
                2017-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/备份恢复/" itemprop="url" rel="index">
                    <span itemprop="name">备份恢复</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>数据是一个企业最重要的资产，备份的重要性不言而喻，有效的备份能够减少意外情况下的公司损失。当使用MySQL数据库时，mysqldump、mysqlpump、mydumper、xtrabackup等都是不错的备份工具，极端情况下，当开启了binlog，也可以成为恢复的救命稻草。但是，还有存在无备份，没有开启binlog的情况，如果是InnoDB表，这时percona推出的Percona Data Recovery Tool工具可以派上用场。</p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">此工具仅支持InnoDB/XtraDB表，不支持MyISAM表</span><br><span class="line">此工具可恢复数据文件的副本，并不要求是正在运行的MySQL服务器</span><br><span class="line">此工具并不保证数据一定可恢复，如数据被覆盖</span><br><span class="line">支持的误操作类型：<span class="keyword">DELETE</span>、<span class="keyword">TRUNCATE</span>，表格式为<span class="keyword">Compact</span></span><br><span class="line">在文件系统级别删除的文件</span><br><span class="line">如数据文件损失，此工具也无法恢复</span><br></pre></td></tr></table></figure>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>通过尝试在页面中找到有效的行来工作，InnoDB的数据都是索引的方式组织的，所有的数据都是存储在16KB的数据块中，每个页面都有属于特定表的特定索引。恢复时分解所有的数据文件为单个16kb大小的页面，根据每个页面的标记的数据起点开始尝试匹配，如果与给定表定义的属于匹配，则输出匹配记录。</p>
<h2 id="表空间"><a href="#表空间" class="headerlink" title="表空间"></a>表空间</h2><p>当服务器设置了innodb_file_per_table=1时，工具不需要再额外的从ibdata1中拆分数据，所有的数据都保存在ibd文件中。<br>当服务器设置了innodb_file_per_table=0时，工具需要先使用page_parser，把数据文件从ibdata1中拆分出来，再按照规则匹配记录。</p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>操作系统：centos 6.5 x86_64</p>
<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> gcc gcc-c++ glibc glibc-<span class="keyword">static</span>  perl-DBI perl-DBD-MySQL</span><br></pre></td></tr></table></figure>
<h2 id="安装Percona-Data-Recovery-Tool"><a href="#安装Percona-Data-Recovery-Tool" class="headerlink" title="安装Percona Data Recovery Tool"></a>安装Percona Data Recovery Tool</h2><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ ~]<span class="comment"># cd /usr/src/</span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ src]<span class="comment"># wget https://launchpad.net/percona-data-recovery-tool-for-innodb/trunk/release-0.5/+download/percona-data-recovery-tool-for-innodb-0.5.tar.gz --no-check-certificate </span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ src]<span class="comment"># tar -zxf percona-data-recovery-tool-for-innodb-0.5.tar.gz </span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ src]<span class="comment"># cd percona-data-recovery-tool-for-innodb-0.5/mysql-source/</span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ mysql-source]<span class="comment"># ./configure </span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ mysql-source]<span class="comment"># cd ..</span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># make</span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># ll</span></span><br><span class="line">总用量 3168</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel   <span class="number"> 6269 </span>8月 <span class="number"> 28 </span>2011 check_data.c</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span>root root  <span class="number"> 748761 </span>7月 <span class="number"> 17 </span>09:06 constraints_parser</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel  <span class="number"> 22172 </span>8月 <span class="number"> 28 </span>2011 constraints_parser.c</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span><span class="number"> 510 </span>wheel  <span class="number"> 12051 </span>8月 <span class="number"> 28 </span>2011 create_defs.pl</span><br><span class="line">drwxr-xr-x <span class="number"> 2 </span><span class="number"> 510 </span>wheel   <span class="number"> 4096 </span>8月 <span class="number"> 28 </span>2011 docs</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span><span class="number"> 510 </span>wheel   <span class="number"> 1978 </span>8月 <span class="number"> 28 </span>2011 fetch_data.sh</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span>root root  <span class="number"> 979051 </span>7月 <span class="number"> 17 </span>09:06 ibdconnect</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel  <span class="number"> 12200 </span>8月 <span class="number"> 28 </span>2011 ibdconnect.c</span><br><span class="line">drwxr-xr-x <span class="number"> 2 </span><span class="number"> 510 </span>wheel   <span class="number"> 4096 </span>8月 <span class="number"> 28 </span>2011 include</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel   <span class="number"> 8262 </span>8月 <span class="number"> 28 </span>2011 incrementalupdate.c</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span>root root   <span class="number"> 14873 </span>7月 <span class="number"> 17 </span>09:06 innochecksum</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel   <span class="number"> 9117 </span>8月 <span class="number"> 28 </span>2011 innochecksum.c</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel     <span class="number"> 74 </span>8月 <span class="number"> 28 </span>2011 INSTALL</span><br><span class="line">drwxr-xr-x <span class="number"> 2 </span>root root    <span class="number"> 4096 </span>7月 <span class="number"> 17 </span>09:06 lib</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel   <span class="number"> 2676 </span>8月 <span class="number"> 28 </span>2011 Makefile</span><br><span class="line">drwxr-xr-x<span class="number"> 40 </span><span class="number"> 510 </span>wheel   <span class="number"> 4096 </span>7月 <span class="number"> 17 </span>09:06 mysql-source</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span>root root <span class="number"> 1346155 </span>7月 <span class="number"> 17 </span>09:06 page_parser</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel  <span class="number"> 15239 </span>8月 <span class="number"> 28 </span>2011 page_parser.c</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel  <span class="number"> 10608 </span>8月 <span class="number"> 28 </span>2011 print_data.c</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span><span class="number"> 510 </span>wheel    <span class="number"> 302 </span>8月 <span class="number"> 28 </span>2011 split_dump.pl</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel   <span class="number"> 2046 </span>8月 <span class="number"> 28 </span>2011 tables_dict.c</span><br></pre></td></tr></table></figure>
<h2 id="恢复实战-delete误操作"><a href="#恢复实战-delete误操作" class="headerlink" title="恢复实战(delete误操作)"></a>恢复实战(delete误操作)</h2><h3 id="innodb-file-per-table-1"><a href="#innodb-file-per-table-1" class="headerlink" title="innodb_file_per_table=1"></a>innodb_file_per_table=1</h3><h4 id="模拟数据被误删除"><a href="#模拟数据被误删除" class="headerlink" title="模拟数据被误删除"></a>模拟数据被误删除</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb<span class="number">-0.5</span>]<span class="comment"># mysql -uroot -p123456</span></span><br><span class="line">Warning: Using a password <span class="keyword">on</span> <span class="keyword">the</span> command line interface can be insecure.</span><br><span class="line">Welcome <span class="keyword">to</span> <span class="keyword">the</span> MySQL monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> \g.</span><br><span class="line">Your MySQL connection <span class="built_in">id</span> <span class="keyword">is</span> <span class="number">35514</span></span><br><span class="line">Server <span class="built_in">version</span>: <span class="number">5.6</span><span class="number">.36</span><span class="number">-82.0</span>-<span class="built_in">log</span> Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) <span class="number">2009</span><span class="number">-2017</span> Percona LLC <span class="keyword">and</span>/<span class="keyword">or</span> <span class="keyword">its</span> affiliates</span><br><span class="line">Copyright (c) <span class="number">2000</span>, <span class="number">2017</span>, Oracle <span class="keyword">and</span>/<span class="keyword">or</span> <span class="keyword">its</span> affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle <span class="keyword">is</span> a registered trademark <span class="keyword">of</span> Oracle Corporation <span class="keyword">and</span>/<span class="keyword">or</span> <span class="keyword">its</span></span><br><span class="line">affiliates. Other names may be trademarks <span class="keyword">of</span> their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' <span class="keyword">or</span> '\h' <span class="keyword">for</span> help. Type '\c' <span class="keyword">to</span> clear <span class="keyword">the</span> current input statement.</span><br><span class="line"></span><br><span class="line">MySQL [(none)] <span class="number">09</span>:<span class="number">25</span>:<span class="number">34</span> &gt; create database test111;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)] <span class="number">09</span>:<span class="number">25</span>:<span class="number">40</span> &gt; use test111;</span><br><span class="line">Database changed</span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">25</span>:<span class="number">43</span> &gt; create table t222(<span class="built_in">id</span> int unsigned <span class="keyword">not</span> null auto_increment,<span class="built_in">name</span> varchar(<span class="number">20</span>),age int,primary key(`<span class="built_in">id</span>`),key idx_age(`age`));   </span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">25</span>:<span class="number">51</span> &gt; insert <span class="keyword">into</span> t222 values(null,'jiessie',<span class="number">18</span>);           </span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">26</span>:<span class="number">00</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;     </span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">1</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">26</span>:<span class="number">10</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;</span><br><span class="line">Query OK, <span class="number">2</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">2</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">26</span>:<span class="number">11</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;</span><br><span class="line">Query OK, <span class="number">4</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">4</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">26</span>:<span class="number">11</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;</span><br><span class="line">Query OK, <span class="number">8</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">8</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">26</span>:<span class="number">12</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;</span><br><span class="line">Query OK, <span class="number">16</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">16</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">26</span>:<span class="number">12</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;</span><br><span class="line">Query OK, <span class="number">32</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">32</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">26</span>:<span class="number">12</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;</span><br><span class="line">Query OK, <span class="number">64</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">64</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">26</span>:<span class="number">13</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;</span><br><span class="line">Query OK, <span class="number">128</span> rows affected (<span class="number">0.01</span> sec)</span><br><span class="line">Records: <span class="number">128</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">26</span>:<span class="number">13</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;</span><br><span class="line">Query OK, <span class="number">256</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">256</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">26</span>:<span class="number">14</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;</span><br><span class="line">Query OK, <span class="number">512</span> rows affected (<span class="number">0.01</span> sec)</span><br><span class="line">Records: <span class="number">512</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">26</span>:<span class="number">14</span> &gt; select <span class="built_in">count</span><span class="comment">(*) from t222;</span></span><br><span class="line"><span class="comment">+<span class="comment">----------+</span></span></span><br><span class="line"><span class="comment">| count<span class="comment">(*) |</span></span></span><br><span class="line"><span class="comment"><span class="comment">+<span class="comment">----------+</span></span></span></span><br><span class="line"><span class="comment"><span class="comment">|     1024 |</span></span></span><br><span class="line"><span class="comment"><span class="comment">+<span class="comment">----------+</span></span></span></span><br><span class="line"><span class="comment"><span class="comment">1 row in set (0.00 sec)</span></span></span><br><span class="line"><span class="comment"><span class="comment"></span></span></span><br><span class="line"><span class="comment"><span class="comment">MySQL [test111] 09:26:21 &gt; exit</span></span></span><br><span class="line"><span class="comment"><span class="comment">Bye</span></span></span><br><span class="line"><span class="comment"><span class="comment">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]# mysql -uroot -p123456 test111 -e "delete from t222;select count<span class="comment">(*) from t222;" &amp;&amp; cp /hwdata/data/percona/test111/t222.* /tmp/</span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment">Warning: Using a password on the command line interface can be insecure.</span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment">+<span class="comment">----------+</span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment">| count<span class="comment">(*) |</span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment">+<span class="comment">----------+</span></span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment">|        0 |</span></span></span></span></span><br><span class="line"><span class="comment"><span class="comment"><span class="comment"><span class="comment">+<span class="comment">----------+</span></span></span></span></span></span><br></pre></td></tr></table></figure>
<h4 id="解析ibd文件"><a href="#解析ibd文件" class="headerlink" title="解析ibd文件"></a>解析ibd文件</h4><p>实战mysql安装在/usr/local/percona，数据目录在/hwdata/data/percona，注意保存数据文件。<br>此过程会将表的idb文件解析为很多的page，innodb的page分为两大部分，一部分一级索引部分（primary key），另一部分为二级索引部分（secondary key），所以解析出来的ibd包括了主键数据和索引数据两大部分（如果该表有多个二级索引，则会生成多个文件<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># ll -t /tmp/t222*</span></span><br><span class="line">-rw-r-----<span class="number"> 1 </span>root root<span class="number"> 163840 </span>7月 <span class="number"> 17 </span>09:26 /tmp/t222.ibd</span><br><span class="line">-rw-r-----<span class="number"> 1 </span>root root  <span class="number"> 8614 </span>7月 <span class="number"> 17 </span>09:26 /tmp/t222.frm</span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># ./page_parser -5 -f /tmp/t222.ibd </span></span><br><span class="line">Opening file: /tmp/t222.ibd:</span><br><span class="line">64513           ID of device containing file</span><br><span class="line">1597422         inode number</span><br><span class="line">33184           protection</span><br><span class="line">1               number of hard links</span><br><span class="line">0               user ID of owner</span><br><span class="line">0               group ID of owner</span><br><span class="line">0               device ID (if special file)</span><br><span class="line">163840          total size, in bytes</span><br><span class="line">4096            blocksize for filesystem I/O</span><br><span class="line">320             number of blocks allocated</span><br><span class="line">1500254806      time of last access</span><br><span class="line">1500254806      time of last modification</span><br><span class="line">1500254806      time of last status change</span><br><span class="line">163840  Size to process in bytes</span><br><span class="line">104857600       Disk cache size in bytes</span><br><span class="line">19.97% done. 2017-07-17 09:27:37 ETA(in 00:00 hours). Processing speed:<span class="number"> 32723 </span>B/sec</span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># ll -t</span></span><br><span class="line">总用量 3172</span><br><span class="line">drwxr-xr-x <span class="number"> 3 </span>root root    <span class="number"> 4096 </span>7月 <span class="number"> 17 </span>09:27 pages-1500254852</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span>root root <span class="number"> 1346155 </span>7月 <span class="number"> 17 </span>09:21 page_parser</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span>root root  <span class="number"> 748729 </span>7月 <span class="number"> 17 </span>09:21 constraints_parser</span><br><span class="line">drwxr-xr-x <span class="number"> 2 </span>root root    <span class="number"> 4096 </span>7月 <span class="number"> 17 </span>09:21 lib</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span>root root  <span class="number"> 979051 </span>7月 <span class="number"> 17 </span>09:06 ibdconnect</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span>root root   <span class="number"> 14873 </span>7月 <span class="number"> 17 </span>09:06 innochecksum</span><br><span class="line">drwxr-xr-x<span class="number"> 40 </span><span class="number"> 510 </span>wheel   <span class="number"> 4096 </span>7月 <span class="number"> 17 </span>09:06 mysql-source</span><br><span class="line">drwxr-xr-x <span class="number"> 2 </span><span class="number"> 510 </span>wheel   <span class="number"> 4096 </span>8月 <span class="number"> 28 </span>2011 docs</span><br><span class="line">drwxr-xr-x <span class="number"> 2 </span><span class="number"> 510 </span>wheel   <span class="number"> 4096 </span>8月 <span class="number"> 28 </span>2011 include</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel   <span class="number"> 6269 </span>8月 <span class="number"> 28 </span>2011 check_data.c</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel  <span class="number"> 22172 </span>8月 <span class="number"> 28 </span>2011 constraints_parser.c</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span><span class="number"> 510 </span>wheel  <span class="number"> 12051 </span>8月 <span class="number"> 28 </span>2011 create_defs.pl</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span><span class="number"> 510 </span>wheel   <span class="number"> 1978 </span>8月 <span class="number"> 28 </span>2011 fetch_data.sh</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel  <span class="number"> 12200 </span>8月 <span class="number"> 28 </span>2011 ibdconnect.c</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel   <span class="number"> 8262 </span>8月 <span class="number"> 28 </span>2011 incrementalupdate.c</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel   <span class="number"> 9117 </span>8月 <span class="number"> 28 </span>2011 innochecksum.c</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel     <span class="number"> 74 </span>8月 <span class="number"> 28 </span>2011 INSTALL</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel   <span class="number"> 2676 </span>8月 <span class="number"> 28 </span>2011 Makefile</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel  <span class="number"> 15239 </span>8月 <span class="number"> 28 </span>2011 page_parser.c</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel  <span class="number"> 10608 </span>8月 <span class="number"> 28 </span>2011 print_data.c</span><br><span class="line">-rwxr-xr-x <span class="number"> 1 </span><span class="number"> 510 </span>wheel    <span class="number"> 302 </span>8月 <span class="number"> 28 </span>2011 split_dump.pl</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span><span class="number"> 510 </span>wheel   <span class="number"> 2046 </span>8月 <span class="number"> 28 </span>2011 tables_dict.c</span><br></pre></td></tr></table></figure></p>
<p>参数解释：<br>-5：代表 row format为Compact mysql5.0后的版本，-4 代表mysql5.0前版本<br>-f：代表要解析的文件 </p>
<h4 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h4><p>从下面的解析后的结果看到，当前目录多了pages-1500254852，其中39为主键索引的index_id,40为二级索引的index_id,该id可以通过开启innodb_table_monitor查看<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-<span class="number">0</span>.<span class="number">5</span>]# ll pages-<span class="number">1500254852</span>/FIL_PAGE_INDEX/<span class="number">0</span>-*</span><br><span class="line">pages-<span class="number">1500254852</span>/FIL_PAGE_INDEX/<span class="number">0</span>-<span class="number">39</span>:</span><br><span class="line">总用量 <span class="number">64</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 09:27 0</span>-<span class="number">00000003</span>.page</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 09:27 2</span>-<span class="number">00000005</span>.page</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 09:27 3</span>-<span class="number">00000006</span>.page</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 09:27 4</span>-<span class="number">00000007</span>.page</span><br><span class="line"></span><br><span class="line">pages-<span class="number">1500254852</span>/FIL_PAGE_INDEX/<span class="number">0</span>-<span class="number">40</span>:</span><br><span class="line">总用量 <span class="number">16</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 09:27 1</span>-<span class="number">00000004</span>.page</span><br></pre></td></tr></table></figure></p>
<h4 id="生成表定义"><a href="#生成表定义" class="headerlink" title="生成表定义"></a>生成表定义</h4><p>由于该工具在解析数据pages的时候，需要获得该table的表结构定义，所以需要执行如下命令。<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb-<span class="number">0.5</span>]<span class="comment"># ./create_defs.pl --host localhost --user root --password 123456 --db test111 --table t222 &gt; include/table_defs.h</span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb-<span class="number">0.5</span>]<span class="comment"># cat include/table_defs.h</span></span><br><span class="line"><span class="comment">#ifndef table_defs_h</span></span><br><span class="line"><span class="comment">#define table_defs_h</span></span><br><span class="line"></span><br><span class="line">/<span class="regexp">/ Table definitions</span></span><br><span class="line"><span class="regexp">table_def_t table_definitions[] = &#123;</span></span><br><span class="line"><span class="regexp">        &#123;</span></span><br><span class="line"><span class="regexp">                name: "t222",</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                        &#123; /</span>* int(<span class="number">10</span>) unsigned *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                                name: "id",</span></span><br><span class="line"><span class="regexp">                                type: FT_UINT,</span></span><br><span class="line"><span class="regexp">                                fixed_length: 4,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                has_limits: FALSE,</span></span><br><span class="line"><span class="regexp">                                limits: &#123;</span></span><br><span class="line"><span class="regexp">                                        can_be_null: FALSE,</span></span><br><span class="line"><span class="regexp">                                        uint_min_val: 0,</span></span><br><span class="line"><span class="regexp">                                        uint_max_val: 4294967295ULL</span></span><br><span class="line"><span class="regexp">                                &#125;,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                can_be_null: FALSE</span></span><br><span class="line"><span class="regexp">                        &#125;,</span></span><br><span class="line"><span class="regexp">                        &#123; /</span>*  *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                                name: "DB_TRX_ID",</span></span><br><span class="line"><span class="regexp">                                type: FT_INTERNAL,</span></span><br><span class="line"><span class="regexp">                                fixed_length: 6,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                can_be_null: FALSE</span></span><br><span class="line"><span class="regexp">                        &#125;,</span></span><br><span class="line"><span class="regexp">                        &#123; /</span>*  *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                                name: "DB_ROLL_PTR",</span></span><br><span class="line"><span class="regexp">                                type: FT_INTERNAL,</span></span><br><span class="line"><span class="regexp">                                fixed_length: 7,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                can_be_null: FALSE</span></span><br><span class="line"><span class="regexp">                        &#125;,</span></span><br><span class="line"><span class="regexp">                        &#123; /</span>* varchar(<span class="number">20</span>) *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                                name: "name",</span></span><br><span class="line"><span class="regexp">                                type: FT_CHAR,</span></span><br><span class="line"><span class="regexp">                                min_length: 0,</span></span><br><span class="line"><span class="regexp">                                max_length: 60,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                has_limits: FALSE,</span></span><br><span class="line"><span class="regexp">                                limits: &#123;</span></span><br><span class="line"><span class="regexp">                                        can_be_null: TRUE,</span></span><br><span class="line"><span class="regexp">                                        char_min_len: 0,</span></span><br><span class="line"><span class="regexp">                                        char_max_len: 60,</span></span><br><span class="line"><span class="regexp">                                        char_ascii_only: TRUE</span></span><br><span class="line"><span class="regexp">                                &#125;,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                can_be_null: TRUE</span></span><br><span class="line"><span class="regexp">                        &#125;,</span></span><br><span class="line"><span class="regexp">                        &#123; /</span>* int(<span class="number">11</span>) *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                                name: "age",</span></span><br><span class="line"><span class="regexp">                                type: FT_INT,</span></span><br><span class="line"><span class="regexp">                                fixed_length: 4,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                has_limits: FALSE,</span></span><br><span class="line"><span class="regexp">                                limits: &#123;</span></span><br><span class="line"><span class="regexp">                                        can_be_null: TRUE,</span></span><br><span class="line"><span class="regexp">                                        int_min_val: -2147483648LL,</span></span><br><span class="line"><span class="regexp">                                        int_max_val: 2147483647LL</span></span><br><span class="line"><span class="regexp">                                &#125;,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                can_be_null: TRUE</span></span><br><span class="line"><span class="regexp">                        &#125;,</span></span><br><span class="line"><span class="regexp">                        &#123; type: FT_NONE &#125;</span></span><br><span class="line"><span class="regexp">                &#125;</span></span><br><span class="line"><span class="regexp">        &#125;,</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">#endif</span></span><br><span class="line"><span class="regexp">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]# </span></span><br><span class="line"><span class="regexp">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]# make</span></span><br><span class="line"><span class="regexp">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=64 -D_LARGEFILE64_SOURCE=1 -D_LARGEFILE_SOURCE=1 -Wall -O3 -g -I include -I mysql-source/include</span> -I mysql-source/innobase/<span class="keyword">include</span> -c tables_dict.c -o <span class="class"><span class="keyword">lib</span>/<span class="title">tables_dict</span>.<span class="title">o</span></span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -c check_data.c -o <span class="class"><span class="keyword">lib</span>/<span class="title">check_data</span>.<span class="title">o</span></span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -o constraints_parser constraints_parser.c <span class="class"><span class="keyword">lib</span>/<span class="title">tables_dict</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">print_data</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">check_data</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">libut</span>.<span class="title">a</span> <span class="title">lib</span>/<span class="title">libmystrings</span>.<span class="title">a</span></span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -static -lrt -o page_parser page_parser.c <span class="class"><span class="keyword">lib</span>/<span class="title">tables_dict</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">libut</span>.<span class="title">a</span> </span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb-<span class="number">0.5</span>]<span class="comment"># make</span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -c tables_dict.c -o <span class="class"><span class="keyword">lib</span>/<span class="title">tables_dict</span>.<span class="title">o</span></span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -c print_data.c -o <span class="class"><span class="keyword">lib</span>/<span class="title">print_data</span>.<span class="title">o</span> </span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -o constraints_parser constraints_parser.c <span class="class"><span class="keyword">lib</span>/<span class="title">tables_dict</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">print_data</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">check_data</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">libut</span>.<span class="title">a</span> <span class="title">lib</span>/<span class="title">libmystrings</span>.<span class="title">a</span></span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -static -lrt -o page_parser page_parser.c <span class="class"><span class="keyword">lib</span>/<span class="title">tables_dict</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">libut</span>.<span class="title">a</span></span></span><br></pre></td></tr></table></figure></p>
<p>上面的命令会将t222表的表定义传入到table_defs.h中，在生成了表结构定义后，重新make该恢复工具  </p>
<p><font color="#dd0000">注意：需要make 2次</font><br> </p>
<h4 id="开始提取page中删除的数据"><a href="#开始提取page中删除的数据" class="headerlink" title="开始提取page中删除的数据"></a>开始提取page中删除的数据</h4><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb<span class="number">-0.5</span>]<span class="comment"># ./constraints_parser -5 -f pages-1500254852/FIL_PAGE_INDEX/0-39/ &gt; /tmp/t222.sql</span></span><br><span class="line">LOAD DATA INFILE <span class="string">'/usr/src/percona-data-recovery-tool-for-innodb-0.5/dumps/default/t222'</span> REPLACE INTO TABLE `<span class="javascript">t222</span>` FIELDS TERMINATED BY <span class="string">'\t'</span> OPTIONALLY ENCLOSED BY <span class="string">'"'</span> LINES STARTING BY <span class="string">'t222\t'</span> (id, name, age);</span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb<span class="number">-0.5</span>]<span class="comment"># cat /tmp/t222.sql |wc -l</span></span><br><span class="line"><span class="number">1024</span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb<span class="number">-0.5</span>]<span class="comment"># head -10 /tmp/t222.sql </span></span><br><span class="line">t222    <span class="number">1</span>       <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">2</span>       <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">3</span>       <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">4</span>       <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">6</span>       <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">7</span>       <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">8</span>       <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">9</span>       <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">13</span>      <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">14</span>      <span class="string">"jiessie"</span>       <span class="number">18</span></span><br></pre></td></tr></table></figure>
<p>参数解释：<br>-5 -f的参数和page_parser相同，代表 row format为Compact ；<br>-D:该参数的含义为代表恢复删除的数据页； </p>
<h4 id="恢复数据"><a href="#恢复数据" class="headerlink" title="恢复数据"></a>恢复数据</h4><p>使用上面constraints_parser执行后的load data导入数据，需要注意目录<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb-<span class="number">0.5</span>]# mysql -uroot -p123456 </span><br><span class="line">Warning: <span class="keyword">Using</span> a password <span class="keyword">on</span> the command line <span class="keyword">interface</span> can be insecure.</span><br><span class="line">Welcome <span class="keyword">to</span> the MySQL monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> \g.</span><br><span class="line">Your MySQL connection id <span class="keyword">is</span> <span class="number">35598</span></span><br><span class="line">Server version: <span class="number">5.6</span>.<span class="number">36</span>-<span class="number">82.0</span>-log Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) <span class="number">2009</span>-<span class="number">2017</span> Percona LLC <span class="keyword">and</span>/<span class="keyword">or</span> its affiliates</span><br><span class="line">Copyright (c) <span class="number">2000</span>, <span class="number">2017</span>, Oracle <span class="keyword">and</span>/<span class="keyword">or</span> its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle <span class="keyword">is</span> a registered trademark <span class="keyword">of</span> Oracle Corporation <span class="keyword">and</span>/<span class="keyword">or</span> its</span><br><span class="line">affiliates. Other names may be trademarks <span class="keyword">of</span> their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line"><span class="keyword">Type</span> <span class="string">'help;'</span> <span class="keyword">or</span> <span class="string">'\h'</span> <span class="keyword">for</span> help. <span class="keyword">Type</span> <span class="string">'\c'</span> <span class="keyword">to</span> clear the current input statement.</span><br><span class="line"></span><br><span class="line">MySQL [(none)] <span class="number">09</span>:<span class="number">32</span>:<span class="number">33</span> &gt; use test111;</span><br><span class="line">Database changed</span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">32</span>:<span class="number">35</span> &gt; LOAD DATA INFILE <span class="string">'/tmp/t222.sql'</span> REPLACE <span class="keyword">INTO</span> TABLE `t222` FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">'\t'</span> OPTIONALLY ENCLOSED <span class="keyword">BY</span> <span class="string">'"'</span> LINES STARTING <span class="keyword">BY</span> <span class="string">'t222\t'</span> (id, name, age);</span><br><span class="line">Query OK, <span class="number">1024</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">1024</span>  Deleted: <span class="number">0</span>  Skipped: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">32</span>:<span class="number">53</span> &gt; <span class="keyword">select</span> count<span class="comment">(*) from t222;</span></span><br><span class="line"><span class="comment">+----------+</span></span><br><span class="line"><span class="comment">| count(*)</span> |</span><br><span class="line">+----------+</span><br><span class="line">|     <span class="number">1024</span> |</span><br><span class="line">+----------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">32</span>:<span class="number">59</span> &gt; <span class="keyword">select</span> * <span class="keyword">from</span> t222 limit <span class="number">10</span>;</span><br><span class="line">+----+---------+------+</span><br><span class="line">| id | name    | age  |</span><br><span class="line">+----+---------+------+</span><br><span class="line">|  <span class="number">1</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">2</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">3</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">4</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">6</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">7</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">8</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">9</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">| <span class="number">13</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">| <span class="number">14</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">+----+---------+------+</span><br><span class="line"><span class="number">10</span> rows <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>查看数据，数据恢复成功。从实验来看，当delete误操作，第一时间要保护好ibd数据，拷贝到其他目录。</p>
<h4 id="恢复脚本"><a href="#恢复脚本" class="headerlink" title="恢复脚本"></a>恢复脚本</h4><p>当误操作的数据量大时，constraints_parser恢复是单线程，速度较慢，此处引用了2个恢复脚本<br>详情请参考：<a href="http://www.orczhou.com/index.php/2013/07/how-to-recover-data-from-mysql-innodb-data-file-ibd-file/" target="_blank" rel="noopener">http://www.orczhou.com/index.php/2013/07/how-to-recover-data-from-mysql-innodb-data-file-ibd-file/</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># pwd</span></span><br><span class="line">/usr/src/percona-data-recovery-tool-for-innodb-0.5</span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># cat parallel_exec.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">ws=/usr/src/percona-data-recovery-tool-for-innodb-0.5/</span><br><span class="line">pagedir=/usr/src/percona-data-recovery-tool-for-innodb-0.5/pages-1500255306/FIL_PAGE_INDEX</span><br><span class="line">logdir=/usr/src/percona-data-recovery-tool-for-innodb-0.5/<span class="built_in">log</span></span><br><span class="line">rectool=/usr/src/percona-data-recovery-tool-for-innodb-0.5/constraints_parser</span><br><span class="line"><span class="built_in">cd</span> `dirname <span class="variable">$rectool</span>`</span><br><span class="line">count=0</span><br><span class="line">page_count=353894</span><br><span class="line">page_done=0</span><br><span class="line">startdate=`date +%s`</span><br><span class="line"><span class="keyword">for</span> d1 <span class="keyword">in</span> `ls <span class="variable">$pagedir</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  count=$((<span class="variable">$count</span>+1))</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"in page <span class="variable">$d2</span> at dir <span class="variable">$d1</span>"</span> &gt; <span class="variable">$logdir</span>/<span class="variable">$count</span>.<span class="built_in">log</span></span><br><span class="line">  thedate=`date +%s`</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$page_done</span> / <span class="variable">$page_count</span> at <span class="variable">$thedate</span> from <span class="variable">$startdate</span>"</span></span><br><span class="line">  total=`ls -l <span class="variable">$pagedir</span>/<span class="variable">$d1</span>/|wc -l`</span><br><span class="line">  page_done=$((<span class="variable">$page_done</span>+<span class="variable">$total</span>))</span><br><span class="line">  threads=`ps axu|grep parser_jobs|grep -v grep|wc -l`</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$threads</span></span><br><span class="line">  <span class="keyword">while</span> [ <span class="variable">$threads</span> -gt 48 ];</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    sleep 1</span><br><span class="line">    threads=`ps axu|grep parser_jobs|grep -v grep|wc -l`</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="variable">$ws</span>/parser_jobs.sh <span class="variable">$pagedir</span>/<span class="variable">$d1</span> &gt; <span class="variable">$ws</span>/job.log 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># cat parser_jobs.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">pagedir=/usr/src/percona-data-recovery-tool-for-innodb-0.5/pages-1500255306/FIL_PAGE_INDEX</span><br><span class="line">logdir=/usr/src/percona-data-recovery-tool-for-innodb-0.5/<span class="built_in">log</span></span><br><span class="line">rectool=/usr/src/percona-data-recovery-tool-for-innodb-0.5/constraints_parser</span><br><span class="line">logfile=<span class="string">"<span class="variable">$logdir</span>/`basename <span class="variable">$1</span>`.log"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$1</span>"</span> &gt; <span class="variable">$logfile</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="variable">$1</span> ];<span class="keyword">then</span></span><br><span class="line">  <span class="keyword">for</span> d2 <span class="keyword">in</span> `ls <span class="variable">$1</span>`</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    <span class="variable">$rectool</span> -5 -f <span class="variable">$1</span>/<span class="variable">$d2</span> &gt;&gt; <span class="variable">$logfile</span> 2&gt;/dev/null</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># ./parallel_exec.sh </span></span><br><span class="line">0 / 353894 at 1500255771 from 1500255771</span><br><span class="line">0</span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># ll log/</span></span><br><span class="line">总用量 296</span><br><span class="line">-rw-r--r-- 1 root root 296770 7月  17 09:42 0-41.log</span><br><span class="line">-rw-r--r-- 1 root root     21 7月  17 09:42 1.log</span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># cat log/0-41.log |wc -l</span></span><br><span class="line">10001</span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># head -10 log/0-41.log </span></span><br><span class="line">/usr/src/percona-data-recovery-tool-for-innodb-0.5/pages-1500255306/FIL_PAGE_INDEX/0-41</span><br><span class="line">employee        3670    3670    <span class="string">"test3670"</span></span><br><span class="line">employee        3671    3671    <span class="string">"test3671"</span></span><br><span class="line">employee        3672    3672    <span class="string">"test3672"</span></span><br><span class="line">employee        3673    3673    <span class="string">"test3673"</span></span><br><span class="line">employee        3674    3674    <span class="string">"test3674"</span></span><br><span class="line">employee        3675    3675    <span class="string">"test3675"</span></span><br><span class="line">employee        3676    3676    <span class="string">"test3676"</span></span><br><span class="line">employee        3677    3677    <span class="string">"test3677"</span></span><br><span class="line">employee        3678    3678    <span class="string">"test3678"</span></span><br></pre></td></tr></table></figure></p>
<p>用法：<br>1.修改脚本路<br>2.修改page_parser后的pages目录<br>3.创建log目录<br>4.执行parallel_exec脚本<br>5.注意，上面演示的示例，0-41.log中在第一行多了一句待恢复innodb页的路径，实际恢复中应删除  </p>
<h3 id="innodb-file-per-table-0"><a href="#innodb-file-per-table-0" class="headerlink" title="innodb_file_per_table=0"></a>innodb_file_per_table=0</h3><h4 id="模拟数据被误删除-1"><a href="#模拟数据被误删除-1" class="headerlink" title="模拟数据被误删除"></a>模拟数据被误删除</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb<span class="number">-0.5</span>]<span class="comment"># mysql -uroot -p123456 -e "show variables like 'innodb_file_per_table'"</span></span><br><span class="line">Warning: Using a password <span class="keyword">on</span> <span class="keyword">the</span> command line interface can be insecure.</span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br><span class="line">| Variable_name         | Value |</span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br><span class="line">| innodb_file_per_table | OFF   |</span><br><span class="line">+<span class="comment">-----------------------+-------+</span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb<span class="number">-0.5</span>]<span class="comment"># mysql -uroot -p123456</span></span><br><span class="line">Warning: Using a password <span class="keyword">on</span> <span class="keyword">the</span> command line interface can be insecure.</span><br><span class="line">Welcome <span class="keyword">to</span> <span class="keyword">the</span> MySQL monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> \g.</span><br><span class="line">Your MySQL connection <span class="built_in">id</span> <span class="keyword">is</span> <span class="number">9</span></span><br><span class="line">Server <span class="built_in">version</span>: <span class="number">5.6</span><span class="number">.36</span><span class="number">-82.0</span>-<span class="built_in">log</span> Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) <span class="number">2009</span><span class="number">-2017</span> Percona LLC <span class="keyword">and</span>/<span class="keyword">or</span> <span class="keyword">its</span> affiliates</span><br><span class="line">Copyright (c) <span class="number">2000</span>, <span class="number">2017</span>, Oracle <span class="keyword">and</span>/<span class="keyword">or</span> <span class="keyword">its</span> affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle <span class="keyword">is</span> a registered trademark <span class="keyword">of</span> Oracle Corporation <span class="keyword">and</span>/<span class="keyword">or</span> <span class="keyword">its</span></span><br><span class="line">affiliates. Other names may be trademarks <span class="keyword">of</span> their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' <span class="keyword">or</span> '\h' <span class="keyword">for</span> help. Type '\c' <span class="keyword">to</span> clear <span class="keyword">the</span> current input statement.</span><br><span class="line"></span><br><span class="line">MySQL [(none)] <span class="number">09</span>:<span class="number">58</span>:<span class="number">22</span> &gt; create database test111;</span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)] <span class="number">09</span>:<span class="number">58</span>:<span class="number">31</span> &gt; use test111;</span><br><span class="line">Database changed</span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">58</span>:<span class="number">34</span> &gt; create table t222(<span class="built_in">id</span> int unsigned <span class="keyword">not</span> null auto_increment,<span class="built_in">name</span> varchar(<span class="number">20</span>),age int,primary key(`<span class="built_in">id</span>`),key idx_age(`age`)); </span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">58</span>:<span class="number">52</span> &gt; insert <span class="keyword">into</span> t222 values(null,'jiessie',<span class="number">18</span>);   </span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">58</span>:<span class="number">57</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;   </span><br><span class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">1</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">59</span>:<span class="number">02</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;   </span><br><span class="line">Query OK, <span class="number">2</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">2</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">59</span>:<span class="number">03</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;   </span><br><span class="line">Query OK, <span class="number">4</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">4</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">59</span>:<span class="number">04</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;   </span><br><span class="line">Query OK, <span class="number">8</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">8</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">59</span>:<span class="number">04</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;                                                                                       </span><br><span class="line">Query OK, <span class="number">16</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">16</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">59</span>:<span class="number">06</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;   </span><br><span class="line">Query OK, <span class="number">32</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">32</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">59</span>:<span class="number">07</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;   </span><br><span class="line">Query OK, <span class="number">64</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">64</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">59</span>:<span class="number">07</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;   </span><br><span class="line">Query OK, <span class="number">128</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">128</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">59</span>:<span class="number">08</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;   </span><br><span class="line">Query OK, <span class="number">256</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">256</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">59</span>:<span class="number">08</span> &gt; insert <span class="keyword">into</span> t222 (<span class="built_in">name</span>,age) select <span class="built_in">name</span>,age <span class="keyword">from</span> t222;   </span><br><span class="line">Query OK, <span class="number">512</span> rows affected (<span class="number">0.00</span> sec)</span><br><span class="line">Records: <span class="number">512</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">09</span>:<span class="number">59</span>:<span class="number">09</span> &gt; select <span class="built_in">count</span><span class="comment">(*) from t222;</span></span><br><span class="line"><span class="comment">+<span class="comment">----------+</span></span></span><br><span class="line"><span class="comment">| count<span class="comment">(*) |</span></span></span><br><span class="line"><span class="comment"><span class="comment">+<span class="comment">----------+</span></span></span></span><br><span class="line"><span class="comment"><span class="comment">|     1024 |</span></span></span><br><span class="line"><span class="comment"><span class="comment">+<span class="comment">----------+</span></span></span></span><br><span class="line"><span class="comment"><span class="comment">1 row in set (0.00 sec)</span></span></span><br></pre></td></tr></table></figure>
<h4 id="解析ibd文件-1"><a href="#解析ibd文件-1" class="headerlink" title="解析ibd文件"></a>解析ibd文件</h4><p>实战mysql安装在/usr/local/percona，数据目录在/hwdata/data/percona，注意保存数据文件。<br>当设置了使用共享表空间(innodb_file_per_table=0)时，所有数据文件存在在ibdata1文件里面，不再是存在在单独表中，此时需要从ibdata1提取出需要被恢复的表<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]</span># ./<span class="selector-tag">page_parser</span> <span class="selector-tag">-5</span> <span class="selector-tag">-f</span> /<span class="selector-tag">tmp</span>/<span class="selector-tag">ibdata1</span> </span><br><span class="line"><span class="selector-tag">Opening</span> <span class="selector-tag">file</span>: /<span class="selector-tag">tmp</span>/<span class="selector-tag">ibdata1</span>:</span><br><span class="line"><span class="selector-tag">64513</span>           <span class="selector-tag">ID</span> <span class="selector-tag">of</span> <span class="selector-tag">device</span> <span class="selector-tag">containing</span> <span class="selector-tag">file</span></span><br><span class="line"><span class="selector-tag">1597426</span>         <span class="selector-tag">inode</span> <span class="selector-tag">number</span></span><br><span class="line"><span class="selector-tag">33184</span>           <span class="selector-tag">protection</span></span><br><span class="line"><span class="selector-tag">1</span>               <span class="selector-tag">number</span> <span class="selector-tag">of</span> <span class="selector-tag">hard</span> <span class="selector-tag">links</span></span><br><span class="line"><span class="selector-tag">0</span>               <span class="selector-tag">user</span> <span class="selector-tag">ID</span> <span class="selector-tag">of</span> <span class="selector-tag">owner</span></span><br><span class="line"><span class="selector-tag">0</span>               <span class="selector-tag">group</span> <span class="selector-tag">ID</span> <span class="selector-tag">of</span> <span class="selector-tag">owner</span></span><br><span class="line"><span class="selector-tag">0</span>               <span class="selector-tag">device</span> <span class="selector-tag">ID</span> (if special file)</span><br><span class="line"><span class="selector-tag">1073741824</span>              <span class="selector-tag">total</span> <span class="selector-tag">size</span>, <span class="selector-tag">in</span> <span class="selector-tag">bytes</span></span><br><span class="line"><span class="selector-tag">4096</span>            <span class="selector-tag">blocksize</span> <span class="selector-tag">for</span> <span class="selector-tag">filesystem</span> <span class="selector-tag">I</span>/<span class="selector-tag">O</span></span><br><span class="line"><span class="selector-tag">2097160</span>         <span class="selector-tag">number</span> <span class="selector-tag">of</span> <span class="selector-tag">blocks</span> <span class="selector-tag">allocated</span></span><br><span class="line"><span class="selector-tag">1500256783</span>      <span class="selector-tag">time</span> <span class="selector-tag">of</span> <span class="selector-tag">last</span> <span class="selector-tag">access</span></span><br><span class="line"><span class="selector-tag">1500256790</span>      <span class="selector-tag">time</span> <span class="selector-tag">of</span> <span class="selector-tag">last</span> <span class="selector-tag">modification</span></span><br><span class="line"><span class="selector-tag">1500256790</span>      <span class="selector-tag">time</span> <span class="selector-tag">of</span> <span class="selector-tag">last</span> <span class="selector-tag">status</span> <span class="selector-tag">change</span></span><br><span class="line"><span class="selector-tag">1073741824</span>      <span class="selector-tag">Size</span> <span class="selector-tag">to</span> <span class="selector-tag">process</span> <span class="selector-tag">in</span> <span class="selector-tag">bytes</span></span><br><span class="line"><span class="selector-tag">104857600</span>       <span class="selector-tag">Disk</span> <span class="selector-tag">cache</span> <span class="selector-tag">size</span> <span class="selector-tag">in</span> <span class="selector-tag">bytes</span></span><br><span class="line"><span class="selector-tag">1</span><span class="selector-class">.65</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:48</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">17666552</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">3</span><span class="selector-class">.41</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19000304</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">5</span><span class="selector-class">.18</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19005354</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">6</span><span class="selector-class">.96</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19008049</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">8</span><span class="selector-class">.73</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19015298</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">10</span><span class="selector-class">.47</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:45</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18719062</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">12</span><span class="selector-class">.24</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19008805</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">14</span><span class="selector-class">.01</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19009523</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">15</span><span class="selector-class">.78</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19007004</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">17</span><span class="selector-class">.55</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19008533</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">19</span><span class="selector-class">.32</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19008676</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">21</span><span class="selector-class">.06</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:45</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18715203</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">22</span><span class="selector-class">.83</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19007750</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">24</span><span class="selector-class">.60</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19002802</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">26</span><span class="selector-class">.37</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18998409</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">28</span><span class="selector-class">.14</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18991699</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">29</span><span class="selector-class">.88</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:45</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18708371</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">31</span><span class="selector-class">.65</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18999365</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">33</span><span class="selector-class">.42</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18997104</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">35</span><span class="selector-class">.19</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19001358</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">36</span><span class="selector-class">.96</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18999823</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">38</span><span class="selector-class">.73</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18997814</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">40</span><span class="selector-class">.47</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:45</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18706585</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">42</span><span class="selector-class">.24</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18996668</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">44</span><span class="selector-class">.01</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18998094</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">45</span><span class="selector-class">.78</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18998427</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">47</span><span class="selector-class">.55</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19002403</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">49</span><span class="selector-class">.30</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:45</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18724158</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">51</span><span class="selector-class">.06</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18997507</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">52</span><span class="selector-class">.83</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18999524</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">54</span><span class="selector-class">.60</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18998796</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">56</span><span class="selector-class">.37</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19000200</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">58</span><span class="selector-class">.14</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18998670</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">59</span><span class="selector-class">.88</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:45</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18699601</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">61</span><span class="selector-class">.65</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19000413</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">63</span><span class="selector-class">.42</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18997737</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">65</span><span class="selector-class">.19</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18996538</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">66</span><span class="selector-class">.96</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18999244</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">68</span><span class="selector-class">.70</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18704824</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">70</span><span class="selector-class">.47</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19002702</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">72</span><span class="selector-class">.24</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19002732</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">74</span><span class="selector-class">.01</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18999341</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">75</span><span class="selector-class">.78</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19001510</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">77</span><span class="selector-class">.55</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18998098</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">79</span><span class="selector-class">.29</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18706109</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">81</span><span class="selector-class">.06</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19007616</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">82</span><span class="selector-class">.83</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19007630</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">84</span><span class="selector-class">.60</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19004630</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">86</span><span class="selector-class">.37</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19004716</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">88</span><span class="selector-class">.12</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18717386</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">89</span><span class="selector-class">.89</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19005803</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">91</span><span class="selector-class">.66</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19007785</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">93</span><span class="selector-class">.43</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19006419</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">95</span><span class="selector-class">.20</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19004360</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">96</span><span class="selector-class">.97</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">19008201</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-tag">98</span><span class="selector-class">.73</span>% <span class="selector-tag">done</span>. <span class="selector-tag">2017-07-17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:03</span><span class="selector-pseudo">:44</span> <span class="selector-tag">ETA</span>(in <span class="number">00</span>:<span class="number">00</span> hours). <span class="selector-tag">Processing</span> <span class="selector-tag">speed</span>: <span class="selector-tag">18940047</span> <span class="selector-tag">B</span>/<span class="selector-tag">sec</span></span><br><span class="line"><span class="selector-attr">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]</span># <span class="selector-tag">ll</span> <span class="selector-tag">-t</span></span><br><span class="line">总用量 <span class="selector-tag">3172</span></span><br><span class="line"><span class="selector-tag">drwxr-xr-x</span>  <span class="selector-tag">4</span> <span class="selector-tag">root</span> <span class="selector-tag">root</span>     <span class="selector-tag">4096</span> <span class="selector-tag">7</span>月  <span class="selector-tag">17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:18</span> <span class="selector-tag">pages-1500257904</span></span><br><span class="line"><span class="selector-tag">-rwxr-xr-x</span>  <span class="selector-tag">1</span> <span class="selector-tag">root</span> <span class="selector-tag">root</span>   <span class="selector-tag">979051</span> <span class="selector-tag">7</span>月  <span class="selector-tag">17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:18</span> <span class="selector-tag">ibdconnect</span></span><br><span class="line"><span class="selector-tag">-rwxr-xr-x</span>  <span class="selector-tag">1</span> <span class="selector-tag">root</span> <span class="selector-tag">root</span>    <span class="selector-tag">14873</span> <span class="selector-tag">7</span>月  <span class="selector-tag">17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:18</span> <span class="selector-tag">innochecksum</span></span><br><span class="line"><span class="selector-tag">-rwxr-xr-x</span>  <span class="selector-tag">1</span> <span class="selector-tag">root</span> <span class="selector-tag">root</span>  <span class="selector-tag">1346155</span> <span class="selector-tag">7</span>月  <span class="selector-tag">17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:18</span> <span class="selector-tag">page_parser</span></span><br><span class="line"><span class="selector-tag">-rwxr-xr-x</span>  <span class="selector-tag">1</span> <span class="selector-tag">root</span> <span class="selector-tag">root</span>   <span class="selector-tag">748761</span> <span class="selector-tag">7</span>月  <span class="selector-tag">17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:18</span> <span class="selector-tag">constraints_parser</span></span><br><span class="line"><span class="selector-tag">drwxr-xr-x</span>  <span class="selector-tag">2</span> <span class="selector-tag">root</span> <span class="selector-tag">root</span>     <span class="selector-tag">4096</span> <span class="selector-tag">7</span>月  <span class="selector-tag">17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:18</span> <span class="selector-tag">lib</span></span><br><span class="line"><span class="selector-tag">drwxr-xr-x</span> <span class="selector-tag">40</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>    <span class="selector-tag">4096</span> <span class="selector-tag">7</span>月  <span class="selector-tag">17</span> <span class="selector-tag">10</span><span class="selector-pseudo">:18</span> <span class="selector-tag">mysql-source</span></span><br><span class="line"><span class="selector-tag">drwxr-xr-x</span>  <span class="selector-tag">2</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>    <span class="selector-tag">4096</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">docs</span></span><br><span class="line"><span class="selector-tag">drwxr-xr-x</span>  <span class="selector-tag">2</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>    <span class="selector-tag">4096</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">include</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>    <span class="selector-tag">6269</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">check_data</span><span class="selector-class">.c</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>   <span class="selector-tag">22172</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">constraints_parser</span><span class="selector-class">.c</span></span><br><span class="line"><span class="selector-tag">-rwxr-xr-x</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>   <span class="selector-tag">12051</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">create_defs</span><span class="selector-class">.pl</span></span><br><span class="line"><span class="selector-tag">-rwxr-xr-x</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>    <span class="selector-tag">1978</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">fetch_data</span><span class="selector-class">.sh</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>   <span class="selector-tag">12200</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">ibdconnect</span><span class="selector-class">.c</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>    <span class="selector-tag">8262</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">incrementalupdate</span><span class="selector-class">.c</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>    <span class="selector-tag">9117</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">innochecksum</span><span class="selector-class">.c</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>      <span class="selector-tag">74</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">INSTALL</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>    <span class="selector-tag">2676</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">Makefile</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>   <span class="selector-tag">15239</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">page_parser</span><span class="selector-class">.c</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>   <span class="selector-tag">10608</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">print_data</span><span class="selector-class">.c</span></span><br><span class="line"><span class="selector-tag">-rwxr-xr-x</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>     <span class="selector-tag">302</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">split_dump</span><span class="selector-class">.pl</span></span><br><span class="line"><span class="selector-tag">-rw-r--r--</span>  <span class="selector-tag">1</span>  <span class="selector-tag">510</span> <span class="selector-tag">wheel</span>    <span class="selector-tag">2046</span> <span class="selector-tag">8</span>月  <span class="selector-tag">28</span> <span class="selector-tag">2011</span> <span class="selector-tag">tables_dict</span><span class="selector-class">.c</span></span><br></pre></td></tr></table></figure></p>
<h4 id="从ibdata1提取待恢复数据"><a href="#从ibdata1提取待恢复数据" class="headerlink" title="从ibdata1提取待恢复数据"></a>从ibdata1提取待恢复数据</h4><p>由于ibdata1恢复的是所有数据，需要从这些数据找到误操作的表，通过查询元数据，得到表空间的id和name<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># mysql -uroot -p123456 </span></span><br><span class="line">Warning: Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 39</span><br><span class="line">Server version: 5.6.36-82.0-log Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2009-2017 Percona LLC and/or its affiliates</span><br><span class="line">Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MySQL [(none)] 10:06:55 &gt; use information_schema;</span><br><span class="line">Database changed</span><br><span class="line">MySQL [information_schema] 10:06:58 &gt; select i.INDEX_ID, i.NAME FROM INNODB_SYS_INDEXES as i INNER JOIN INNODB_SYS_TABLES as t USING(TABLE_ID) WHERE t.NAME='test111/t222';</span><br><span class="line">+----------+---------+</span><br><span class="line">| INDEX_ID | NAME    |</span><br><span class="line">+----------+---------+</span><br><span class="line">|      <span class="number"> 20 </span>| PRIMARY |</span><br><span class="line">|      <span class="number"> 21 </span>| idx_age |</span><br><span class="line">+----------+---------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MySQL [information_schema] 10:06:59 &gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment"># ll pages-1500256968/FIL_PAGE_INDEX/</span></span><br><span class="line">总用量 68</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-1</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-11</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-12</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-13</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-14</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-15</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-16</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-17</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-18</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-19</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-2</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-20</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-21</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-3</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-4</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 0-5</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root root<span class="number"> 4096 </span>7月 <span class="number"> 17 </span>10:02 4294967295-0</span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<h4 id="结果分析-1"><a href="#结果分析-1" class="headerlink" title="结果分析"></a>结果分析</h4><p>从下面的解析后的结果看到，当前目录pages-1500257904，其中20为主键索引的index_id,21为二级索引的index_id,该id可以通过开启innodb_table_monitor查看<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-<span class="number">0</span>.<span class="number">5</span>]# ll pages-<span class="number">1500256968</span>/FIL_PAGE_INDEX/<span class="number">0</span>-<span class="number">20</span>/</span><br><span class="line">总用量 <span class="number">128</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 10:02 15</span>-<span class="number">00000054</span>.page</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 10:02 17</span>-<span class="number">00000056</span>.page</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 10:02 18</span>-<span class="number">00000057</span>.page</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 10:02 19</span>-<span class="number">00000058</span>.page</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 10:02 20</span>-<span class="number">00000054</span>.page</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 10:02 22</span>-<span class="number">00000057</span>.page</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 10:02 23</span>-<span class="number">00000056</span>.page</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 10:02 24</span>-<span class="number">00000058</span>.page</span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-<span class="number">0</span>.<span class="number">5</span>]# ll pages-<span class="number">1500256968</span>/FIL_PAGE_INDEX/<span class="number">0</span>-<span class="number">21</span></span><br><span class="line">总用量 <span class="number">32</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 10:02 16</span>-<span class="number">00000055</span>.page</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">16384 7</span>月  <span class="number">17 10:02 21</span>-<span class="number">00000055</span>.page</span><br></pre></td></tr></table></figure></p>
<h4 id="生成表定义-1"><a href="#生成表定义-1" class="headerlink" title="生成表定义"></a>生成表定义</h4><p>由于该工具在解析数据pages的时候，需要获得该table的表结构定义，所以需要执行如下命令。<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb-<span class="number">0.5</span>]<span class="comment"># ./create_defs.pl --host localhost --user root --password 123456 --db test111 --table t222 &gt; include/table_defs.h</span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb-<span class="number">0.5</span>]<span class="comment"># cat include/table_defs.h</span></span><br><span class="line"><span class="comment">#ifndef table_defs_h</span></span><br><span class="line"><span class="comment">#define table_defs_h</span></span><br><span class="line"></span><br><span class="line">/<span class="regexp">/ Table definitions</span></span><br><span class="line"><span class="regexp">table_def_t table_definitions[] = &#123;</span></span><br><span class="line"><span class="regexp">        &#123;</span></span><br><span class="line"><span class="regexp">                name: "t222",</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                        &#123; /</span>* int(<span class="number">10</span>) unsigned *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                                name: "id",</span></span><br><span class="line"><span class="regexp">                                type: FT_UINT,</span></span><br><span class="line"><span class="regexp">                                fixed_length: 4,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                has_limits: FALSE,</span></span><br><span class="line"><span class="regexp">                                limits: &#123;</span></span><br><span class="line"><span class="regexp">                                        can_be_null: FALSE,</span></span><br><span class="line"><span class="regexp">                                        uint_min_val: 0,</span></span><br><span class="line"><span class="regexp">                                        uint_max_val: 4294967295ULL</span></span><br><span class="line"><span class="regexp">                                &#125;,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                can_be_null: FALSE</span></span><br><span class="line"><span class="regexp">                        &#125;,</span></span><br><span class="line"><span class="regexp">                        &#123; /</span>*  *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                                name: "DB_TRX_ID",</span></span><br><span class="line"><span class="regexp">                                type: FT_INTERNAL,</span></span><br><span class="line"><span class="regexp">                                fixed_length: 6,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                can_be_null: FALSE</span></span><br><span class="line"><span class="regexp">                        &#125;,</span></span><br><span class="line"><span class="regexp">                        &#123; /</span>*  *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                                name: "DB_ROLL_PTR",</span></span><br><span class="line"><span class="regexp">                                type: FT_INTERNAL,</span></span><br><span class="line"><span class="regexp">                                fixed_length: 7,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                can_be_null: FALSE</span></span><br><span class="line"><span class="regexp">                        &#125;,</span></span><br><span class="line"><span class="regexp">                        &#123; /</span>* varchar(<span class="number">20</span>) *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                                name: "name",</span></span><br><span class="line"><span class="regexp">                                type: FT_CHAR,</span></span><br><span class="line"><span class="regexp">                                min_length: 0,</span></span><br><span class="line"><span class="regexp">                                max_length: 60,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                has_limits: FALSE,</span></span><br><span class="line"><span class="regexp">                                limits: &#123;</span></span><br><span class="line"><span class="regexp">                                        can_be_null: TRUE,</span></span><br><span class="line"><span class="regexp">                                        char_min_len: 0,</span></span><br><span class="line"><span class="regexp">                                        char_max_len: 60,</span></span><br><span class="line"><span class="regexp">                                        char_ascii_only: TRUE</span></span><br><span class="line"><span class="regexp">                                &#125;,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                can_be_null: TRUE</span></span><br><span class="line"><span class="regexp">                        &#125;,</span></span><br><span class="line"><span class="regexp">                        &#123; /</span>* int(<span class="number">11</span>) *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">                                name: "age",</span></span><br><span class="line"><span class="regexp">                                type: FT_INT,</span></span><br><span class="line"><span class="regexp">                                fixed_length: 4,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                has_limits: FALSE,</span></span><br><span class="line"><span class="regexp">                                limits: &#123;</span></span><br><span class="line"><span class="regexp">                                        can_be_null: TRUE,</span></span><br><span class="line"><span class="regexp">                                        int_min_val: -2147483648LL,</span></span><br><span class="line"><span class="regexp">                                        int_max_val: 2147483647LL</span></span><br><span class="line"><span class="regexp">                                &#125;,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                                can_be_null: TRUE</span></span><br><span class="line"><span class="regexp">                        &#125;,</span></span><br><span class="line"><span class="regexp">                        &#123; type: FT_NONE &#125;</span></span><br><span class="line"><span class="regexp">                &#125;</span></span><br><span class="line"><span class="regexp">        &#125;,</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">#endif</span></span><br><span class="line"><span class="regexp">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]# </span></span><br><span class="line"><span class="regexp">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-for-innodb-0.5]# make</span></span><br><span class="line"><span class="regexp">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=64 -D_LARGEFILE64_SOURCE=1 -D_LARGEFILE_SOURCE=1 -Wall -O3 -g -I include -I mysql-source/include</span> -I mysql-source/innobase/<span class="keyword">include</span> -c tables_dict.c -o <span class="class"><span class="keyword">lib</span>/<span class="title">tables_dict</span>.<span class="title">o</span></span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -c check_data.c -o <span class="class"><span class="keyword">lib</span>/<span class="title">check_data</span>.<span class="title">o</span></span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -o constraints_parser constraints_parser.c <span class="class"><span class="keyword">lib</span>/<span class="title">tables_dict</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">print_data</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">check_data</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">libut</span>.<span class="title">a</span> <span class="title">lib</span>/<span class="title">libmystrings</span>.<span class="title">a</span></span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -static -lrt -o page_parser page_parser.c <span class="class"><span class="keyword">lib</span>/<span class="title">tables_dict</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">libut</span>.<span class="title">a</span> </span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb-<span class="number">0.5</span>]<span class="comment"># make</span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -c tables_dict.c -o <span class="class"><span class="keyword">lib</span>/<span class="title">tables_dict</span>.<span class="title">o</span></span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -c print_data.c -o <span class="class"><span class="keyword">lib</span>/<span class="title">print_data</span>.<span class="title">o</span> </span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -o constraints_parser constraints_parser.c <span class="class"><span class="keyword">lib</span>/<span class="title">tables_dict</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">print_data</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">check_data</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">libut</span>.<span class="title">a</span> <span class="title">lib</span>/<span class="title">libmystrings</span>.<span class="title">a</span></span></span><br><span class="line">gcc -DHAVE_OFFSET64_T -D_FILE_OFFSET_BITS=<span class="number">64</span> -D_LARGEFILE64_SOURCE=<span class="number">1</span> -D_LARGEFILE_SOURCE=<span class="number">1</span> -Wall -O3 -g -I <span class="keyword">include</span> -I mysql-source/<span class="keyword">include</span> -I mysql-source/innobase/<span class="keyword">include</span> -static -lrt -o page_parser page_parser.c <span class="class"><span class="keyword">lib</span>/<span class="title">tables_dict</span>.<span class="title">o</span> <span class="title">lib</span>/<span class="title">libut</span>.<span class="title">a</span></span></span><br></pre></td></tr></table></figure></p>
<p>上面的命令会将t222表的表定义传入到table_defs.h中，在生成了表结构定义后，重新make该恢复工具  </p>
<p><font color="#dd0000">注意：需要make 2次</font><br> </p>
<h4 id="开始提取page中删除的数据-1"><a href="#开始提取page中删除的数据-1" class="headerlink" title="开始提取page中删除的数据"></a>开始提取page中删除的数据</h4><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb<span class="number">-0.5</span>]<span class="comment"># ./constraints_parser -5 -f pages-1500258331/FIL_PAGE_INDEX/0-20/ &gt; /tmp/0_t222.sql            </span></span><br><span class="line">LOAD DATA INFILE <span class="string">'/usr/src/percona-data-recovery-tool-for-innodb-0.5/dumps/default/t222'</span> REPLACE INTO TABLE `<span class="javascript">t222</span>` FIELDS TERMINATED BY <span class="string">'\t'</span> OPTIONALLY ENCLOSED BY <span class="string">'"'</span> LINES STARTING BY <span class="string">'t222\t'</span> (id, name, age);</span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb<span class="number">-0.5</span>]<span class="comment"># cat /tmp/0_t222.sql |wc -l</span></span><br><span class="line"><span class="number">2048</span></span><br><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb<span class="number">-0.5</span>]<span class="comment"># head -10 /tmp/0_t222.sql </span></span><br><span class="line">t222    <span class="number">1145</span>    <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">1146</span>    <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">1147</span>    <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">1148</span>    <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">1149</span>    <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">1150</span>    <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">1151</span>    <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">1152</span>    <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">1153</span>    <span class="string">"jiessie"</span>       <span class="number">18</span></span><br><span class="line">t222    <span class="number">1154</span>    <span class="string">"jiessie"</span>       <span class="number">18</span></span><br></pre></td></tr></table></figure>
<p>从结果上来看，数据重复了一份，通过load data导入只导入一份正常的数据<br>参数解释：<br>-5 -f的参数和page_parser相同，代表 row format为Compact ；<br>-D:该参数的含义为代表恢复删除的数据页； </p>
<h4 id="恢复数据-1"><a href="#恢复数据-1" class="headerlink" title="恢复数据"></a>恢复数据</h4><p>使用上面constraints_parser执行后的load data导入数据，需要注意目录<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6c08fdv8duubho2b0rZ percona-data-recovery-tool-<span class="keyword">for</span>-innodb-<span class="number">0.5</span>]# mysql -uroot -p123456</span><br><span class="line">Warning: <span class="keyword">Using</span> a password <span class="keyword">on</span> the command line <span class="keyword">interface</span> can be insecure.</span><br><span class="line">Welcome <span class="keyword">to</span> the MySQL monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> \g.</span><br><span class="line">Your MySQL connection id <span class="keyword">is</span> <span class="number">108</span></span><br><span class="line">Server version: <span class="number">5.6</span>.<span class="number">36</span>-<span class="number">82.0</span>-log Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) <span class="number">2009</span>-<span class="number">2017</span> Percona LLC <span class="keyword">and</span>/<span class="keyword">or</span> its affiliates</span><br><span class="line">Copyright (c) <span class="number">2000</span>, <span class="number">2017</span>, Oracle <span class="keyword">and</span>/<span class="keyword">or</span> its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle <span class="keyword">is</span> a registered trademark <span class="keyword">of</span> Oracle Corporation <span class="keyword">and</span>/<span class="keyword">or</span> its</span><br><span class="line">affiliates. Other names may be trademarks <span class="keyword">of</span> their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line"><span class="keyword">Type</span> <span class="string">'help;'</span> <span class="keyword">or</span> <span class="string">'\h'</span> <span class="keyword">for</span> help. <span class="keyword">Type</span> <span class="string">'\c'</span> <span class="keyword">to</span> clear the current input statement.</span><br><span class="line"></span><br><span class="line">MySQL [(none)] <span class="number">10</span>:<span class="number">28</span>:<span class="number">16</span> &gt; use test111;</span><br><span class="line">Database changed</span><br><span class="line">MySQL [test111] <span class="number">10</span>:<span class="number">28</span>:<span class="number">20</span> &gt; LOAD DATA INFILE <span class="string">'/tmp/0_t222.sql'</span> REPLACE <span class="keyword">INTO</span> TABLE `t222` FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">'\t'</span> OPTIONALLY ENCLOSED <span class="keyword">BY</span> <span class="string">'"'</span> LINES STARTING <span class="keyword">BY</span> <span class="string">'t222\t'</span> (id, name, age);</span><br><span class="line">Query OK, <span class="number">2048</span> rows affected (<span class="number">0.01</span> sec)</span><br><span class="line">Records: <span class="number">2048</span>  Deleted: <span class="number">0</span>  Skipped: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">10</span>:<span class="number">28</span>:<span class="number">39</span> &gt; <span class="keyword">select</span> count<span class="comment">(*) from t222;</span></span><br><span class="line"><span class="comment">+----------+</span></span><br><span class="line"><span class="comment">| count(*)</span> |</span><br><span class="line">+----------+</span><br><span class="line">|     <span class="number">1024</span> |</span><br><span class="line">+----------+</span><br><span class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">MySQL [test111] <span class="number">10</span>:<span class="number">28</span>:<span class="number">44</span> &gt; <span class="keyword">select</span> * <span class="keyword">from</span> t222 limit <span class="number">10</span>;</span><br><span class="line">+----+---------+------+</span><br><span class="line">| id | name    | age  |</span><br><span class="line">+----+---------+------+</span><br><span class="line">|  <span class="number">1</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">2</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">3</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">4</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">6</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">7</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">8</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">|  <span class="number">9</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">| <span class="number">13</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">| <span class="number">14</span> | jiessie |   <span class="number">18</span> |</span><br><span class="line">+----+---------+------+</span><br><span class="line"><span class="number">10</span> rows <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>从结果看，数据恢复完成   </p>
<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>Percona Data Recovery Tool for InnoDB工具并不保证100%能够恢复数据，而且会存在丢失数据的现象，特别是当发生误删除后，数据文件并没有第一时间保存起来，而导致了被重写。truncate操作在此不做演示，建议还是做好备份恢复工作，并做日常的演练。</p>

      
    </div>
    
    
    

    

    

    
<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

  
</div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/percona/" rel="tag"># percona</a>
          
            <a href="/tags/innodb/" rel="tag"># innodb</a>
          
            <a href="/tags/recovery/" rel="tag"># recovery</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/percona-server-5-6-自制rpm包.html" rel="next" title="percona server 5.6 自制rpm包">
                <i class="fa fa-chevron-left"></i> percona server 5.6 自制rpm包
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/MongoDB从MMAPv1在线迁移至WiredTiger引擎.html" rel="prev" title="MongoDB从MMAPv1在线迁移至WiredTiger引擎">
                MongoDB从MMAPv1在线迁移至WiredTiger引擎 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/jiessie.png"
                alt="Jiessie" />
            
              <p class="site-author-name" itemprop="name">Jiessie</p>
              <p class="site-description motion-element" itemprop="description">最怕一生碌碌无为,还说平凡难能可贵！</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://www.percona.com/" target="_blank" title="Percona">
                      
                        <i class="fa fa-fw fa-globe"></i>Percona</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://mariadb.com/kb/zh-cn/mariadb/" target="_blank" title="MariaDB">
                      
                        <i class="fa fa-fw fa-globe"></i>MariaDB</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://mysqlserverteam.com/" target="_blank" title="serverteam">
                      
                        <i class="fa fa-fw fa-globe"></i>serverteam</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://mysqlhighavailability.com/" target="_blank" title="highavailability">
                      
                        <i class="fa fa-fw fa-globe"></i>highavailability</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://mysql.taobao.org/monthly/" target="_blank" title="淘宝月报">
                      
                        <i class="fa fa-fw fa-globe"></i>淘宝月报</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://dimitrik.free.fr/blog/" target="_blank" title="dimitrik">
                      
                        <i class="fa fa-fw fa-globe"></i>dimitrik</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注意事项"><span class="nav-number">2.</span> <span class="nav-text">注意事项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原理"><span class="nav-number">3.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表空间"><span class="nav-number">4.</span> <span class="nav-text">表空间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备"><span class="nav-number">5.</span> <span class="nav-text">准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装依赖"><span class="nav-number">6.</span> <span class="nav-text">安装依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装Percona-Data-Recovery-Tool"><span class="nav-number">7.</span> <span class="nav-text">安装Percona Data Recovery Tool</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#恢复实战-delete误操作"><span class="nav-number">8.</span> <span class="nav-text">恢复实战(delete误操作)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#innodb-file-per-table-1"><span class="nav-number">8.1.</span> <span class="nav-text">innodb_file_per_table=1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#模拟数据被误删除"><span class="nav-number">8.1.1.</span> <span class="nav-text">模拟数据被误删除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解析ibd文件"><span class="nav-number">8.1.2.</span> <span class="nav-text">解析ibd文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#结果分析"><span class="nav-number">8.1.3.</span> <span class="nav-text">结果分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#生成表定义"><span class="nav-number">8.1.4.</span> <span class="nav-text">生成表定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#开始提取page中删除的数据"><span class="nav-number">8.1.5.</span> <span class="nav-text">开始提取page中删除的数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#恢复数据"><span class="nav-number">8.1.6.</span> <span class="nav-text">恢复数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#恢复脚本"><span class="nav-number">8.1.7.</span> <span class="nav-text">恢复脚本</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#innodb-file-per-table-0"><span class="nav-number">8.2.</span> <span class="nav-text">innodb_file_per_table=0</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#模拟数据被误删除-1"><span class="nav-number">8.2.1.</span> <span class="nav-text">模拟数据被误删除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解析ibd文件-1"><span class="nav-number">8.2.2.</span> <span class="nav-text">解析ibd文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#从ibdata1提取待恢复数据"><span class="nav-number">8.2.3.</span> <span class="nav-text">从ibdata1提取待恢复数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#结果分析-1"><span class="nav-number">8.2.4.</span> <span class="nav-text">结果分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#生成表定义-1"><span class="nav-number">8.2.5.</span> <span class="nav-text">生成表定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#开始提取page中删除的数据-1"><span class="nav-number">8.2.6.</span> <span class="nav-text">开始提取page中删除的数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#恢复数据-1"><span class="nav-number">8.2.7.</span> <span class="nav-text">恢复数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结束语"><span class="nav-number">9.</span> <span class="nav-text">结束语</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jiessie</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共字</span>
</div>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  


<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

</body>
</html>
